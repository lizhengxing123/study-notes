<!--
 * @Descripttion: 
 * @Author: lizhengxing
 * @Date: 2022-10-02 11:36:46
 * @LastEditTime: 2022-10-12 19:53:29
-->
## ç±»å‹

#### 1ã€å€¼ç±»å‹

> å› ä¸ºè¿™äº›ç±»å‹çš„å˜é‡å§‹ç»ˆæŒ‰å€¼æ¥ä¼ é€’ï¼Œå½“è¿™äº›å˜é‡è¢«ç”¨ä½œå‡½æ•°å‚æ•°æˆ–è€…ç”¨åœ¨èµ‹å€¼è¯­å¥ä¸­æ—¶ï¼Œæ€»ä¼šè¿›è¡Œå€¼æ‹·è´ã€‚

##### 1-1ã€å¸ƒå°”ç±»å‹

`bool` å–å€¼ä¸ºå­—é¢å¸¸é‡ `true` å’Œ `false`ã€‚é»˜è®¤ä¸º `false`ã€‚

è¿ç®—ç¬¦ï¼š

- `!` é€»è¾‘é
- `&&` é€»è¾‘ä¸ï¼ˆçŸ­è·¯ï¼‰
- `||` é€»è¾‘æˆ–ï¼ˆçŸ­è·¯ï¼‰
- `==` ç­‰äº
- `!=` ä¸ç­‰äº

##### 1-2ã€æ•´å‹

> [å‚è€ƒæ–‡ç« ](https://toutiao.io/posts/kwbfvk/preview)

`int`/`uint`ï¼šåˆ†åˆ«è¡¨ç¤ºæœ‰ç¬¦å·å’Œæ— ç¬¦å·çš„ä¸åŒä½æ•°çš„æ•´å‹å˜é‡ã€‚æ”¯æŒ `int8` ~ `int256` ä»¥åŠ `uint8` ~ `uint256`ï¼Œä»¥8ä½ä¸ºæ­¥é•¿é€’å¢ï¼ˆä»8 bit (1 byte) åˆ° 256bit (32 bytes) ï¼‰ã€‚`uint` å’Œ `int` åˆ†åˆ«æ˜¯ `uint256` å’Œ `int256` çš„åˆ«åã€‚åˆå§‹å€¼éƒ½ä¸º `0`.

`int` èŒƒå›´æ˜¯ `-2^(n - 1) ~ 2^(n - 1) - 1`ï¼Œæ¯”å¦‚ `int8` èŒƒå›´å°±æ˜¯ `-128 ~ 127`

`uint` èŒƒå›´æ˜¯ `0 ~ 2^n - 1`ï¼Œæ¯”å¦‚ `uint8` èŒƒå›´å°±æ˜¯ `0 ~ 255`

è¿ç®—ç¬¦ï¼š

- æ¯”è¾ƒè¿ç®—ç¬¦ï¼š `<=`ã€`<`ã€`==`ã€`>`ã€`>=`ã€`!=` è¿”å›å¸ƒå°”å€¼
- ä½è¿ç®—ç¬¦ï¼š`&`ã€`|`ã€`^` ï¼ˆå¼‚æˆ–ï¼‰ã€`~` ï¼ˆä½å–åï¼‰

  > åœ¨æ•°å­—çš„äºŒè¿›åˆ¶è¡¥ç è¡¨ç¤ºä¸Šæ‰§è¡Œï¼Œè¿™æ„å‘³ç€ `~int256 (0) == int256 (-1)`
  > & : ç›¸åŒä½ï¼Œä¸¤ä¸ªéƒ½ä¸º1æ‰æ˜¯1ï¼Œåªè¦æœ‰ä¸€ä¸ªæ˜¯0å°±æ˜¯0
  > | : ç›¸åŒä½ï¼Œä¸¤ä¸ªæœ‰ä¸€ä¸ª1å°±æ˜¯æ˜¯1ï¼Œéƒ½æ˜¯æ˜¯0å°±æ˜¯0
  > ^ : ç›¸åŒä½ï¼Œä¸ç›¸ç­‰ä¸º1ï¼Œç›¸ç­‰ä¸º0
  > ï½ : 0å˜ä¸º1ï¼Œ1å˜ä¸º0

- ç§»ä½è¿ç®—ç¬¦ï¼š`<<` ï¼ˆå·¦ç§»ä½ï¼‰ã€`>>` ï¼ˆå³ç§»ä½ï¼‰

  > ç»“æœæ€»æ˜¯è¢«æˆªæ–­çš„
  > `x << y` ç›¸å½“äº `x * 2 ** y`
  > `x >> y` ç›¸å½“äº `x / 2 ** y`ï¼Œå››èˆäº”å…¥åˆ°è´Ÿæ— ç©·
  ```solidity
  int a = -1 << 2; // a = -1 * 2 ** 2 = -1 * 4 = -4
  int b = -1 >> 2; // b = -1 / 2 ** 2 = -1 / 4 = 0 ï¼ˆé™¤æ³•æˆªæ–­ï¼‰
  ```

- ç®—æ•°è¿ç®—ç¬¦ï¼š`+` ã€`â€”` ã€ä¸€å…ƒè¿ç®—ç¬¦ `â€”`ï¼ˆé’ˆå¯¹`int`ï¼‰ã€`*`ã€ `/`ã€`%`ï¼ˆå–ä½™ï¼‰ã€** ï¼ˆå¹‚ï¼‰

  > å–ä½™æ„¿ç®—ç»“æœä¸å·¦æ“ä½œæ•°çš„ç¬¦å·ç›¸åŒ
  > å¹‚è¿ç®—ä»…é€‚ç”¨äºæ— ç¬¦å·ç±»å‹ `0**0 == 1`

æº¢å‡ºï¼š

- å¯¹äº `int`

```solidity
function intOverflow() public pure returns (int8, int8, int8) {
  int8 a = 127;
  return (a, a + 1, a*a);
}
// è¾“å‡ºä¸º
0: int8: 127
1: int8: -128
2: int8: 1
```
- å¯¹äº `uint`

```solidity
function uintOverflow() public pure returns (uint8, uint8, uint8) {
  uint8 a = 255;
  return (a, a + 1, a*a);
}
// è¾“å‡ºä¸º
0: uint8: 255
1: uint8: 0
2: uint8: 1
```

é™¤æ³•æˆªæ–­ï¼š

> æ•´æ•°é™¤æ³•æ€»æ˜¯äº§ç”Ÿæ•´æ•°ï¼Œåˆ†æ•°ä¼šå–0ï¼Œé™¤ä»¥0ä¼šå‘ç”Ÿé”™è¯¯

```solidity
function litOverflow() public pure returns(int256, int256){
  int a = 1;
  int b = 4;
  return ((a/b)*100, (1/4)*100);
}
// è¾“å‡ºä¸º
0: int256: 0
1: int256: 25
```

##### 1-3ã€å®šé•¿æµ®ç‚¹å‹

> solidity è¿˜æ²¡æœ‰å®Œå…¨æ”¯æŒå®šé•¿æµ®ç‚¹å‹ã€‚å¯ä»¥å£°æ˜è¯¥ç±»å‹å˜é‡ï¼Œä½†ä¸èƒ½ç»™ä»–ä»¬èµ‹å€¼æˆ–æŠŠä»–ä»¬èµ‹å€¼ç»™å…¶ä»–å˜é‡ã€‚

`fixed` / `ufixed`: è¡¨ç¤ºå„ç§å¤§å°çš„æœ‰ç¬¦å·å’Œæ— ç¬¦å·çš„å®šé•¿æµ®ç‚¹å‹ã€‚åœ¨å…³é”®å­— `ufixedMxN` å’Œ `fixedMxN` ä¸­ï¼Œ `M` è¡¨ç¤ºè¯¥ç±»å‹å ç”¨çš„ä½æ•°ï¼ˆåŒ…æ‹¬å°æ•°ä½å’Œæ•´æ•°ä½ï¼‰ï¼Œå¿…é¡»èƒ½æ•´é™¤8ï¼Œå³8ï½256ï¼Œ`N`è¡¨ç¤ºå¯ç”¨çš„å°æ•°ä½æ•°ï¼Œ0ï½80ä¹‹é—´çš„ä»»ä½•æ•°ã€‚`fixed` å’Œ `ufixed` åˆ†åˆ«æ˜¯ `fixed128x19` å’Œ `ufixed128x19` çš„åˆ«ç§°ã€‚

> å®ƒä¸æµ®ç‚¹å‹æœ€å¤§çš„ä¸åŒç‚¹åœ¨äºï¼šæµ®ç‚¹å‹çš„æ•´æ•°å’Œæ¶ˆæš‘ä¸åˆ†éœ€è¦çš„ä½æ•°æ˜¯çµæ´»å¯å˜çš„ï¼Œè€Œå®ƒçš„æ•´æ•°å’Œå°æ•°éƒ¨åˆ†çš„é•¿åº¦æ”¶åˆ°ä¸¥æ ¼çš„è§„å®šã€‚

è¿ç®—ç¬¦ï¼š

- æ¯”è¾ƒè¿ç®—ç¬¦ï¼š `<=`ã€`<`ã€`==`ã€`>`ã€`>=`ã€`!=` è¿”å›å¸ƒå°”å€¼
- ç®—æ•°è¿ç®—ç¬¦ï¼š`+` ã€`â€”` ã€ä¸€å…ƒè¿ç®—ç¬¦ `â€”`ã€ä¸€å…ƒè¿ç®—ç¬¦ `+`ã€`*`ã€ `/`ã€`%`ï¼ˆå–ä½™ï¼‰

##### 1-4ã€åœ°å€ç±»å‹

- `address`ï¼šä¿å­˜ä¸€ä¸ª20å­—èŠ‚çš„å€¼ï¼ˆä»¥å¤ªåŠåœ°å€çš„å¤§å°ï¼‰
- `address payable`ï¼šå¯æ”¯ä»˜åœ°å€ï¼Œä¸ `address` ç›¸åŒï¼Œä¸è¿‡æœ‰æˆå‘˜å‡½æ•° `transfer` å’Œ `send`ã€‚å¯ä»¥å‘å…¶å‘é€ä»¥å¤ªå¸ã€‚

> å…è®¸ä» `address payable` åˆ° `address` çš„éšå¼è½¬æ¢ï¼Œè€Œä» `address` åˆ° `address payable` å¿…é¡»æ˜¾å¼è½¬æ¢ï¼Œé€šè¿‡ `payable(<address>)` è¿›è¡Œè½¬æ¢ã€‚


`address` å…è®¸å’Œ `uint160`ã€æ•´å‹å­—é¢å¸¸é‡ã€`bytes20`åŠåˆçº¦ç±»å‹è¿›è¡Œè½¬æ¢ã€‚

åªèƒ½é€šè¿‡`payable(<address>)`æŠŠ `address`ç±»å‹å’Œåˆçº¦ç±»å‹è½¬æ¢ä¸º`address payable`ã€‚åªæœ‰èƒ½æ¥å—ä»¥å¤ªå¸çš„åˆçº¦ç±»å‹ï¼Œæ‰èƒ½è¿›è¡Œæ­¤è½¬æ¢ã€‚ä¾‹å¦‚åˆçº¦è¦ä¹ˆæœ‰ `receive` æˆ–å¯æ”¯ä»˜çš„å›é€€å‡½æ•°ã€‚

> payable(0) æ˜¯æœ‰æ•ˆçš„ï¼Œè¿™æ˜¯æ­¤è§„åˆ™çš„ä¾‹å¤–ã€‚

è¿ç®—ç¬¦ï¼š `<=`ã€`<`ã€`==`ã€`>`ã€`>=`ã€`!=`

> å¦‚æœå°†ä½¿ç”¨è¾ƒå¤§å­—èŠ‚æ•°ç»„ç±»å‹è½¬æ¢ä¸º`address`ï¼Œé‚£ä¹ˆ`address`å°†è¢«æˆªæ–­ã€‚

###### åœ°å€ç±»å‹æˆå‘˜å˜é‡

- `balance` å’Œ `transfer` æˆå‘˜

å¯ä»¥ä½¿ç”¨`balance`å±æ€§æ¥æŸ¥è¯¢ä¸€ä¸ªåœ°å€çš„ä½™é¢ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨`transfer`å‡½æ•°å‘ä¸€ä¸ªå¯æ”¯ä»˜çš„åœ°å€å‘é€ä»¥å¤ªå¸ï¼ˆä»¥weiä¸ºå•ä½ï¼‰ã€‚

å¦‚æœå½“å‰åˆçº¦ä½™é¢ä¸è¶³ï¼Œåˆ™`transfer`å‡½æ•°ä¼šæ‰§è¡Œå¤±è´¥ï¼Œæˆ–è€…å¦‚æœä¸€å°è½¬ç§»è¢«æ¥å—è´¦æˆ·æ‹’ç»ï¼Œ`transfer`å‡½æ•°åŒæ ·ä¼šå¤±è´¥è€Œè¿›è¡Œå›é€€ã€‚

> \<address\>.balanceï¼šä»¥`wei`ä¸ºå•ä½çš„åœ°å€ä½™é¢ï¼Œç±»å‹ä¸º `uin256`
> \<address payable\>.transfer(uint256 amount)ï¼šå‘åœ°å€å‘é€`amount`æ•°é‡çš„`wei`ï¼Œå¤±è´¥æ—¶æŠ›å‡ºå¼‚å¸¸ï¼Œä½¿ç”¨å›ºå®šçš„2300`gas`çŸ¿å·¥è´¹ã€‚

- `send` æˆå‘˜

`send`æ˜¯`transfer`çš„ä½çº§ç‰ˆæœ¬ã€‚å¦‚æœæ‰§è¡Œå¤±è´¥ï¼Œå½“å‰åˆçº¦ä¸ä¼šå› ä¸ºå¼‚å¸¸è€Œç»ˆæ­¢ï¼Œä¼šè¿”å›`false`ã€‚

> \<address payable\>.transfer(uint256 amount) returns (bool)ï¼šå‘åœ°å€å‘é€`amount`æ•°é‡çš„`wei`ï¼Œå¤±è´¥æ—¶è¿”å›`false`ï¼Œä½¿ç”¨å›ºå®šçš„2300`gas`çŸ¿å·¥è´¹ã€‚

- `call` ã€ `delegatecall` å’Œ `staticcall`

> \<address\>.call(bytes memory) returns (bool, bytes memory)ï¼šç”¨ç»™å®šçš„æœ‰æ•ˆè½½è·ï¼ˆpayloadï¼‰å‘å‡ºä½çº§ CALL è°ƒç”¨ï¼Œè¿”å›æˆåŠŸçŠ¶æ€åŠè¿”å›æ•°æ®ï¼Œå‘é€æ‰€æœ‰å¯ç”¨ gasï¼Œä¹Ÿå¯ä»¥è°ƒèŠ‚ gasã€‚æ”¯æŒ value é€‰é¡¹ã€‚
> \<address\>.delegatecall(bytes memory) returns (bool, bytes memory)ï¼šç”¨ç»™å®šçš„æœ‰æ•ˆè½½è· å‘å‡ºä½çº§ DELEGATECALL è°ƒç”¨ ï¼Œè¿”å›æˆåŠŸçŠ¶æ€å¹¶è¿”å›æ•°æ®ï¼Œå‘é€æ‰€æœ‰å¯ç”¨ gasï¼Œä¹Ÿå¯ä»¥è°ƒèŠ‚ gasã€‚
> \<address\>.staticcall(bytes memory) returns (bool, bytes memory)ï¼šç”¨ç»™å®šçš„æœ‰æ•ˆè½½è· å‘å‡ºä½çº§ STATICCALL è°ƒç”¨ ï¼Œè¿”å›æˆåŠŸçŠ¶æ€å¹¶è¿”å›æ•°æ®ï¼Œå‘é€æ‰€æœ‰å¯ç”¨ gasï¼Œä¹Ÿå¯ä»¥è°ƒèŠ‚ gasã€‚

```solidity
// ç›®å‰ä¸æ‡‚
address(nameReg).call{gas: 1000000, value: 1 ether}(abi.encodeWithSignature("register(string)", "MyName"));
```

- `code` å’Œ `codehash` æˆå‘˜

> \<address\>.codeï¼šè¿”å› `bytes memory`ï¼Œå€¼å¯èƒ½ä¸ºç©ºã€‚
> \<address\>.codehashï¼šè¿”å›è¯¥ä»£ç çš„keccak-256å“ˆå¸Œå€¼ï¼Œä¸º`bytes32`ã€‚
> `addr.codehash`æ¯”`keccak256(addr.code)`æ›´ä¾¿å®œ
> æ‰€æœ‰åˆçº¦éƒ½å¯ä»¥è½¬æ¢ä¸º `address`ç±»å‹ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨`address(this).balance`æŸ¥è¯¢å½“å‰åˆçº¦çš„ä½™é¢ã€‚

##### 1-5ã€åˆçº¦ç±»å‹

æ¯ä¸€ä¸ª`contract`å®šä¹‰éƒ½æœ‰å®ƒè‡ªå·±çš„ç±»å‹ã€‚åˆçº¦å¯ä»¥æ˜¾å¼è½¬æ¢ä¸º`address`ç±»å‹ã€‚

åªæœ‰å½“åˆçº¦å…·æœ‰æ¥æ”¶ `receive` å‡½æ•°æˆ– `payable`å›é€€å‡½æ•°æ—¶ï¼Œæ‰èƒ½æ˜¾å¼å’Œ `address payable`ç±»å‹ç›¸äº’è½¬æ¢ï¼Œè½¬æ¢ä½¿ç”¨`address(x)`æ‰§è¡Œï¼Œå¦‚æœåˆçº¦ç±»å‹æ²¡æœ‰æ¥æ”¶æˆ– `payable`å›é€€åŠŸèƒ½ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ `payable(address(x))`è½¬æ¢ä¸º`address payable`ç±»å‹ã€‚

åˆçº¦ä¸æ”¯æŒä»»ä½•è¿ç®—ç¬¦ã€‚åˆçº¦ç±»å‹çš„æˆå‘˜æ˜¯åˆçº¦çš„å¤–éƒ¨å‡½æ•°åŠpublicçš„çŠ¶æ€å˜é‡ã€‚

##### 1-6ã€å®šé•¿å­—èŠ‚æ•°ç»„

å…³é”®å­—æœ‰ `bytes1` `bytes2` ... `bytes32`

è¿ç®—ç¬¦ï¼š

- æ¯”è¾ƒè¿ç®—ç¬¦ï¼š `<=`ã€`<`ã€`==`ã€`>`ã€`>=`ã€`!=` è¿”å›å¸ƒå°”å€¼
- ä½è¿ç®—ç¬¦ï¼š`&`ã€`|`ã€`^` ï¼ˆå¼‚æˆ–ï¼‰ã€`~` ï¼ˆä½å–åï¼‰
- ç§»ä½è¿ç®—ç¬¦ï¼š`<<` ï¼ˆå·¦ç§»ä½ï¼‰ã€`>>` ï¼ˆå³ç§»ä½ï¼‰
- ç´¢å¼•è®¿é—®ï¼šå¦‚æœ `x` æ˜¯ `bytesI` ç±»å‹ï¼Œé‚£ä¹ˆ `x[k]` (å…¶ä¸­ `0 <= k < I`) è¿”å›ç¬¬ `k` ä¸ªå­—èŠ‚ï¼ˆåªè¯»ï¼‰
- `.length` è¡¨ç¤ºè¿™ä¸ªå­—èŠ‚æ•°ç»„çš„é•¿åº¦ï¼Œä¸èƒ½ä¿®æ”¹é•¿åº¦

```solidity
// SPDX-License-Identifier: MIT

pragma solidity ^0.8.0;

contract BytesArray {
  bytes1 num1 = 0x7a; // åå…­è¿›åˆ¶æ¯ä¸€ä½ä»£è¡¨äºŒè¿›åˆ¶å››ä½ 0111 1010
  bytes2 num2 = 0x7a68; // åå…­è¿›åˆ¶æ¯ä¸€ä½ä»£è¡¨äºŒè¿›åˆ¶å››ä½ 0111 1010 0110 1000

  function getLength() public view returns (uint8, uint8) {
    return (num1.length, num2.length); // è¿”å›å­—èŠ‚çš„é•¿åº¦ï¼Œåˆ†åˆ«ä¸º1å’Œ2
  }

  function getEl() public view returns (bytes1, bytes1, bytes1) {
    // num1[1] ä¼šæŠ¥é”™ï¼Œè®¿é—®å…ƒç´ è¶…è¿‡å­—èŠ‚é•¿åº¦
    return (num1[0], num2[0], num2[1]); // 0x7a 0x7a 0x68
  }
}
```

##### 1-7ã€å˜é•¿å­—èŠ‚æ•°ç»„

- `bytes`ï¼šå˜é•¿å­—èŠ‚æ•°ç»„ï¼Œå¹¶ä¸æ˜¯å€¼ç±»å‹

```solidity
// SPDX-License-Identifier: MIT

pragma solidity ^0.8.0;

contract DynamicByte {
  // nameé•¿åº¦ä¸º3
  bytes public name = new bytes(3);

  function initName() public {
      // nameçš„å€¼ä¸º 0x676869
      name[0] = 0x67;
      name[1] = 0x68;
      name[2] = 0x69;
  }

  function getLength() public view returns(uint256) {
      return name.length; // 3
  }

  function changeLength() public {
      name.push(0xaa); // nameé•¿åº¦åŠ 1ï¼Œä¸º4ï¼Œnameçš„å€¼ä¿®æ”¹ä¸º 0x679969aa
  }

  function changeName() public {
      name[1] = 0x99; // nameçš„å€¼ä¿®æ”¹ä¸º 0x679969
  }
}
```

- `string`ï¼šå˜é•¿UTF-8ç¼–ç å­—ç¬¦ä¸²ç±»å‹ï¼Œå¹¶ä¸æ˜¯å€¼ç±»å‹ï¼Œæ— æ³•è·å–é•¿åº¦ï¼Œä¹Ÿæ— æ³•é€šè¿‡ç´¢å¼•è®¿é—®

```solidity
// SPDX-License-Identifier: MIT

pragma solidity ^0.8.0;

contract DynamicString {
  string public name = "lizhengxing"; // 0x6c697a68656e6778696e67

  function getLength() public view returns(uint256) {
      // return name.length; // æ— æ³•è·å–length
      return bytes(name).length; // 11ï¼Œè½¬æ¢æˆå­—èŠ‚å¯ä»¥è·å–
  }

  function getName() public view returns(bytes memory) {
      return bytes(name); // 0x6c697a68656e6778696e67
  }

  function changeName() public {
      bytes(name)[1] = "u"; // name -> luzhengxing getName => 0x6c757a68656e6778696e67
  }

  // ä¸­æ–‡æµ‹è¯•

  function getChineseNameLength(string memory _name) public pure returns(uint256) {
      return bytes(_name).length; // è¾“å…¥ææ­£æ˜Ÿ =ã€‹ 9ï¼Œä¸€ä¸ªä¸­æ–‡å ä¸‰ä¸ªå­—èŠ‚
  }

  function getChineseNameName(string memory _name) public pure returns(bytes memory) {
      return bytes(_name); // è¾“å…¥ææ­£æ˜Ÿ =ã€‹ 0xe69d8ee6ada3e6989f
  }
}
```

##### 1-8ã€åœ°å€å­—é¢å¸¸é‡

æ¯”å¦‚åƒ `0xA47C311F7A9Ed6Dab0e10a990696631937912db9`ï¼ˆé•¿åº¦ä¸º42ä½ï¼‰ è¿™æ ·çš„é€šè¿‡äº†åœ°å€æ ¡éªŒå’Œæµ‹è¯•çš„åå…­è¿›åˆ¶å­—é¢é‡ä¼šä½œä¸º `address` ç±»å‹ã€‚è€Œæ²¡æœ‰é€šè¿‡æ ¡éªŒæµ‹è¯•çš„é•¿åº¦åœ¨39ï½41ä¸ªæ•°å­—ä¹‹é—´çš„åå…­è¿›åˆ¶å­—é¢å¸¸é‡ï¼Œä¼šäº§ç”Ÿä¸€ä¸ªé”™è¯¯ï¼Œå¯ä»¥åœ¨0å‰é¢æ·»åŠ ï¼ˆå¯¹äºæ•´æ•°ç±»å‹ï¼‰æˆ–åœ¨0åé¢æ·»åŠ ï¼ˆå¯¹äº`bytesNN`ç±»å‹ï¼‰ï¼Œä»¥æ¶ˆé™¤é”™è¯¯ã€‚

##### 1-9ã€æœ‰ç†æ•°å’Œæ•´æ•°å­—é¢å¸¸é‡

- æ•´æ•°å­—é¢å¸¸é‡ç”±èŒƒå›´åœ¨ `0-9` çš„ä¸€ä¸²æ•°å­—ç»„æˆï¼Œè¡¨ç°ä¸ºåè¿›åˆ¶ï¼Œä¾‹å¦‚ `35` `ã€‚solidity` ä¸­æ²¡æœ‰å…«è¿›åˆ¶ï¼Œæ‰€ä»¥å‰ç½®`0`æ— æ•ˆã€‚
- åè¿›åˆ¶å°æ•°å­—é¢å¸¸é‡å¸¦æœ‰ä¸€ä¸ª `.`ï¼Œåé¢è‡³å°‘ä¸€ä¸ªæ•°å­—ï¼Œä¾‹å¦‚ `.1` ã€`1.2`ï¼Œæ²¡æœ‰ `1.0`ã€‚
- `MeE`ï¼ˆ`M * 10 ** E`ï¼‰çš„ç§‘å­¦ç¬¦å·ï¼ŒæŒ‡æ•°å¿…é¡»ä¸ºæ•´æ•°ï¼Œåº•æ•°å¯ä»¥æ˜¯å°æ•°ï¼Œä¾‹å¦‚`-2e10` ã€ `1.2e23`ã€‚
- ä¸ºäº†æé«˜å¯è¯»æ€§ï¼Œå¯ä»¥åœ¨æ•°å­—ä¹‹é—´æ·»åŠ ä¸‹åˆ’çº¿ã€‚ä¾‹å¦‚ `123_123` `0x2eff_abde` `1_2e34_34`ã€‚ä¸‹åˆ’çº¿ä»…å…è®¸åœ¨ä¸¤ä½æ•°ä¹‹é—´ï¼Œä¸”ä¸èƒ½è¿ç»­å‡ºç°ã€‚
- åœ¨æ•°å€¼å¸¸é‡è¡¨è¾¾å¼ä¸­ï¼Œè®¡ç®—ä¸ä¼šæº¢å‡ºï¼Œé™¤æ³•ä¹Ÿä¸ä¼šæˆªæ–­ã€‚
- æœ‰ç†æ•°ä¸ºæ•´æ•°ï¼ˆæ­£æ•´æ•°ã€0ã€è´Ÿæ•´æ•°ï¼‰å’Œåˆ†æ•°çš„ç»Ÿç§° ã€‚ æ­£æ•´æ•°å’Œæ­£åˆ†æ•°åˆç§°ä¸ºæ­£æœ‰ç†æ•°ï¼Œè´Ÿæ•´æ•°å’Œè´Ÿåˆ†æ•°åˆç§°ä¸ºè´Ÿæœ‰ç†æ•°ã€‚ å› è€Œæœ‰ç†æ•°é›†çš„æ•°å¯åˆ†ä¸ºæ­£æœ‰ç†æ•°ã€è´Ÿæœ‰ç†æ•°å’Œé›¶ã€‚
- solidityå¯¹æ¯ä¸ªæœ‰ç†æ•°éƒ½æœ‰å¯¹åº”çš„æ•°å­—å­—é¢å¸¸é‡ç±»å‹ã€‚æ•´æ•°å­—é¢å¸¸é‡å’Œæœ‰ç†æ•°å­—é¢å¸¸é‡éƒ½å±äºæ•°å€¼å­—é¢å¸¸é‡ç±»å‹ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œæ‰€æœ‰çš„æ•°å€¼å­—é¢å¸¸é‡è¡¨è¾¾å¼éƒ½å±äºæ•°å€¼å­—é¢å¸¸é‡ã€‚
- æ•°å€¼å­—é¢å¸¸é‡è¡¨è¾¾å¼åªè¦åœ¨éå­—é¢å¸¸é‡è¡¨è¾¾å¼ä¸­ä½¿ç”¨å°±ä¼šè½¬åŒ–ä¸ºéå­—é¢å¸¸é‡ç±»å‹ã€‚

##### 1-10ã€å­—ç¬¦ä¸²å­—é¢å¸¸é‡åŠç±»å‹

- å­—ç¬¦ä¸²å­—é¢å¸¸é‡æ˜¯æŒ‡ç”±åŒå¼•å·æˆ–å•å¼•å·å¼•èµ·æ¥çš„å­—ç¬¦ä¸²ã€‚å¯ä»¥åˆ†ä¸ºå¤šä¸ªè¿ç»­éƒ¨åˆ†ï¼Œä¾‹å¦‚ `"foo" "bar"` ç­‰æ•ˆäº `"foobar"`ã€‚
- å¯ä»¥éšå¼è½¬æ¢ä¸º `bytes1` `bytes2` ... `bytes32`ï¼Œå¦‚æœåˆé€‚çš„è¯ï¼Œè¿˜å¯ä»¥è½¬æ¢ä¸º `bytes` å’Œ `string`ã€‚
- æ”¯æŒçš„è½¬ä¹‰å­—ç¬¦åŒ…å«ï¼š`\<newline>` ï¼ˆè½¬ä¹‰å®é™…æ¢è¡Œï¼‰ã€`\\` ï¼ˆåæ–œæ ï¼‰ã€`\'` ï¼ˆå•å¼•å·ï¼‰ã€`\"` ï¼ˆåŒå¼•å·ï¼‰ã€`\b` ï¼ˆé€€æ ¼ï¼‰ã€`\f` ï¼ˆæ¢é¡µï¼‰ã€`\n` ï¼ˆæ¢è¡Œï¼‰ã€`\r` ï¼ˆå›è½¦ï¼‰ã€`\t` ï¼ˆæ ‡ç­¾tabï¼‰ã€`\v` ï¼ˆå‚ç›´æ ‡ç­¾ï¼‰ã€`\xNN` ï¼ˆåå…­è¿›åˆ¶è½¬ä¹‰ï¼‰ã€`\uNNN` ï¼ˆunicodeè½¬ä¹‰ï¼‰
  
```solidity
 "\n\"\'\\abc\
 def"
```

##### 1-11ã€Unicodeå­—é¢å¸¸é‡

ä»¥å…³é”®å­—unicodeä¸ºå‰ç¼€ï¼Œå¯ä»¥åŒ…å«ä»»æ„æœ‰æ•ˆçš„UTF-8åºåˆ—ï¼Œå®ƒè¿˜æ”¯æŒä¸è½¬ä¹‰åºåˆ—å®Œå…¨ç›¸åŒçš„å­—ç¬¦ä½œä¸ºå¸¸è§„å­—ç¬¦ä¸²æ–‡å­—ã€‚

```solidity
string memory a = unicode"hello ğŸ˜Š";
```

##### 1-12ã€åå…­è¿›åˆ¶å­—é¢å¸¸é‡

- ä»¥å…³é”®å­—hexä¸ºå‰ç¼€ï¼Œåé¢ç´§è·Ÿç”¨å•å¼•å·æˆ–åŒå¼•å·å¼•èµ·æ¥çš„å­—ç¬¦ä¸²ï¼Œä¾‹å¦‚`hex"001122FF"`ã€‚å­—ç¬¦ä¸²çš„å†…å®¹å¿…é¡»æ˜¯ä¸€ä¸ªåå…­è¿›åˆ¶çš„æ•°å­—ï¼Œå­—é¢å¸¸é‡çš„å€¼å°†æ˜¯è¯¥åå…­è¿›åˆ¶æ•°å­—çš„äºŒè¿›åˆ¶è¡¨ç¤ºå½¢å¼ã€‚
- ç”¨ç©ºæ ¼åˆ†å¼€çš„å¤šä¸ªåå…­è¿›åˆ¶å­—é¢å¸¸é‡è¢«åˆå¹¶ä¸ºä¸€ä¸ªå­—é¢å¸¸é‡ï¼Œä¾‹å¦‚ `hex"00112233" hex"44556677"` ç­‰æ•ˆäº `hex"0011223344556677"`

##### 1-13ã€æšä¸¾ç±»å‹

æšä¸¾æ˜¯åˆ›å»ºç”¨æˆ·å®šä¹‰ç±»å‹çš„ä¸€ç§æ–¹æ³•ã€‚æšä¸¾éœ€è¦è‡³å°‘ä¸€ä¸ªæˆå‘˜ï¼Œé»˜è®¤æ˜¯ç¬¬ä¸€ä¸ªæˆå‘˜ï¼Œä¸èƒ½å¤šäº256ä¸ªæˆå‘˜ã€‚é€‰é¡¹ä»0å¼€å§‹çš„æ— ç¬¦å·æ•´æ•°å€¼è¡¨ç¤ºã€‚

ä½¿ç”¨ `type(NameOfEnum).min` å’Œ `type(NameOfEnum).max` å¯ä»¥å¾—åˆ°ç»™å®šæšä¸¾çš„æœ€å°å€¼å’Œæœ€å¤§å€¼ã€‚

```solidity
// SPDX-License-Identifier: MIT

pragma solidity ^0.8.8;

contract Test {
  // å€¼ä¸º{0,1,2,3}
  enum ActionChoices { GoLeft, GoRight, GoStraight, SitStill }
  ActionChoices choice;
  // defaultChoice ä¸º 2ï¼Œ constant ä»£è¡¨å¸¸é‡
  ActionChoices constant defaultChoice = ActionChoices.GoStraight;

  function setGoStraight() public {
      // choice ä¸º 2 
      choice = ActionChoices.GoStraight;
  }

  // ç”±äºæšä¸¾ç±»å‹ä¸å±äº ABI çš„ä¸€éƒ¨åˆ†ï¼Œå› æ­¤å¯¹äºæ‰€æœ‰æ¥è‡ª Solidity å¤–éƒ¨çš„è°ƒç”¨ï¼Œ
  // getChoice çš„ç­¾åä¼šè‡ªåŠ¨æ”¹æˆ â€œgetChoice() returns (uint8)â€

  function getChoice() public view returns (ActionChoices) {
      return choice; // 2
  }

  function getDefaultChoice() public pure returns (uint) {
      return uint(defaultChoice); // 2
  }

  function getLargestValue() public pure returns (ActionChoices) {
      return type(ActionChoices).max; // 3
  }

  function getSmallestValue() public pure returns (ActionChoices) {
      return type(ActionChoices).min; // 0
  }
}
```

##### 1-14ã€ç”¨æˆ·å®šä¹‰çš„å€¼ç±»å‹

- ä¸€ä¸ªç”¨æˆ·å®šä¹‰çš„å€¼ç±»å‹å…è®¸åœ¨ä¸€ä¸ªåŸºæœ¬çš„å€¼ç±»å‹ä¸Šåˆ›å»ºä¸€ä¸ªé›¶æˆæœ¬çš„æŠ½è±¡ï¼Œè¿™ç±»ä¼¼äºä¸€ä¸ªåˆ«åï¼Œä½†æœ‰æ›´ä¸¥æ ¼çš„ç±»å‹è¦æ±‚ã€‚
- ä½¿ç”¨ `type C is V` æ¥å®šä¹‰ï¼Œå…¶ä¸­ `C` æ˜¯æ–°çš„ç±»å‹ï¼Œ `V`å¿…é¡»æ˜¯å†…ç½®çš„å€¼ç±»å‹ï¼ˆåº•å±‚ç±»å‹ï¼‰ã€‚å‡½æ•° `C.wrap` è¢«ç”¨æ¥ä»åº•å±‚ç±»å‹è½¬æ¢åˆ°è‡ªå®šä¹‰ç±»å‹ï¼Œå‡½æ•° `C.unwrap` è¢«ç”¨æ¥ä»è‡ªå®šä¹‰ç±»å‹è½¬æ¢åˆ°åº•å±‚ç±»å‹ã€‚
- æ–°ç±»å‹ `C` æ²¡æœ‰ä»»ä½•è¿ç®—ç¬¦æˆ–ç»‘å®šæˆå‘˜å‡½æ•°ï¼Œä¹Ÿä¸å…è®¸äºå…¶ä»–ç±»å‹è¿›è¡Œæ˜¾å¼å’Œéšå¼è½¬æ¢ã€‚
- è‡ªå®šä¹‰ç±»å‹çš„å€¼çš„æ•°æ®è¡¨ç¤ºç»§æ‰¿è‡ªåº•å±‚ç±»å‹ã€‚

```solidity 
// SPDX-License-Identifier: MIT

pragma solidity ^0.8.8;

// 256ä½å…¶ä¸­åŒ…å«18ä½å°æ•°çš„åè¿›åˆ¶å®šç‚¹ç±»å‹
type UFixed256x18 is uint256;
// åœ¨ UFixed256x18 ä¸Šè¿›è¡Œæ“ä½œçš„åº“
library FixedMath {
  uint constant multiplier = 10 ** 18;

  // ä¸¤ä¸ªUFixed256x18ç±»å‹ç›¸åŠ ï¼Œæº¢å‡ºæ¢å¤ï¼Œ
  // ä¾èµ–äºuin256çš„æ£€æŸ¥ç®—æ³•
  function add(UFixed256x18 _a, UFixed256x18 _b) internal pure returns (UFixed256x18) {
      // .wrap ä»åº•å±‚ç±»å‹uint256è½¬æ¢åˆ°è‡ªå®šä¹‰ç±»å‹UFixed256x18
      // .unwrap ä»è‡ªå®šä¹‰ç±»å‹UFixed256x18è½¬æ¢åˆ°åº•å±‚ç±»å‹uint256
      return UFixed256x18.wrap(UFixed256x18.unwrap(_a) + UFixed256x18.unwrap(_b));
  }

  // UFixed256x18 å’Œ uint256 ç›¸ä¹˜
  function mul(UFixed256x18 _a, uint256 _b) internal pure returns (UFixed256x18) {
      return UFixed256x18.wrap(UFixed256x18.unwrap(_a) * _b);
  }

  // å‘ä¸‹å–æ•´ï¼Œè¿”å›ä¸è¶…è¿‡açš„æœ€å¤§æ•´æ•°
  function floor(UFixed256x18 _a) internal pure returns (uint256) {
      return UFixed256x18.unwrap(_a) / multiplier;
  }

  // å°† uint256 è½¬æ¢ä¸ºç›¸åŒå€¼çš„ UFixed256x18ç±»å‹ï¼Œæ•´æ•°å¤ªå¤§ä¼šæ¢å¤
  function toUFixed256x18(uint256 _a) internal pure returns (UFixed256x18) {
      return UFixed256x18.wrap(_a * multiplier);
  }
}
```

##### 1-15ã€å‡½æ•°ç±»å‹

```solidity
function (<parameter types>) {internal|external} [pure|constant|view|payable] [returns (<return types>)]
```

- internalï¼š(__é»˜è®¤__)å†…éƒ¨å‡½æ•°ï¼Œåªèƒ½åœ¨å½“å‰åˆçº¦å†…éƒ¨å’Œç»§æ‰¿çš„åˆçº¦å†…éƒ¨è°ƒç”¨
- externalï¼šå¤–éƒ¨å‡½æ•°ï¼Œç”±ä¸€ä¸ªåœ°å€å’Œä¸€ä¸ªå‡½æ•°ç­¾åç»„æˆï¼Œå¯ä»¥é€šè¿‡å¤–éƒ¨å‡½æ•°è°ƒç”¨ä¼ é€’æˆ–è¿”å›

ç±»å‹è½¬æ¢ï¼š

- å‡½æ•°ç±»å‹Aå¯ä»¥éšå¼è½¬æ¢ä¸ºå‡½æ•°ç±»å‹Bå½“ä¸”ä»…å½“ï¼šä»–ä»¬çš„å‚æ•°ç±»å‹ç›¸åŒï¼Œè¿”å›ç±»å‹ç›¸åŒï¼Œå†…éƒ¨/å¤–éƒ¨å±æ€§ç›¸åŒï¼Œå¹¶ä¸”Açš„çŠ¶æ€å¯å˜æ€§æ¯”Bçš„çŠ¶æ€å¯å˜æ€§æ›´å…·é™åˆ¶æ€§ï¼Œä¾‹å¦‚ï¼š
  - `pure` å‡½æ•°å¯ä»¥è½¬æ¢ä¸º `view` å’Œ `non-payable` å‡½æ•°
  - `view` å‡½æ•°å¯ä»¥è½¬æ¢ä¸º `non-payable` å‡½æ•°
  - `payable` å‡½æ•°å¯ä»¥è½¬æ¢ä¸º `non-payable` å‡½æ•°
  > å…³äº `payable` å’Œ `non-payable` å‡½æ•°ï¼šå¦‚æœä¸€ä¸ªå‡½æ•°æ˜¯ `payable`ï¼Œè¿™æ„å‘³ç€å®ƒä¹Ÿæ¥å—é›¶ä»¥å¤ªæ”¯ä»˜ï¼Œå› æ­¤ä»–ä¹Ÿæ˜¯ `non-payable` å‡½æ•°ã€‚å¦ä¸€æ–¹é¢ï¼Œ`non-payable` å‡½æ•°å°†æ‹’ç»å‘é€ç»™ä»–çš„ä»¥å¤ªå¸ï¼Œæ‰€ä»¥ `non-payable` å‡½æ•°ä¸èƒ½è½¬æ¢ä¸º `payable` å‡½æ•°ã€‚
- `public` å‡½æ•°æ—¢å¯ä»¥æ˜¯å†…éƒ¨å‡½æ•°ï¼Œä¹Ÿå¯ä»¥æ˜¯å¤–éƒ¨å‡½æ•°ã€‚å¦‚æœæƒ³å°†ä¸€ä¸ªå‡½æ•°å½“ä½œå†…éƒ¨å‡½æ•°è°ƒç”¨ï¼Œå°±ä½¿ç”¨ `f` è°ƒç”¨ï¼Œå¦‚æœæƒ³å°†å…¶å½“ä½œå¤–éƒ¨å‡½æ•°è°ƒç”¨ï¼Œå°±ä½¿ç”¨ `this.f` è°ƒç”¨
  
æˆå‘˜æ–¹æ³•ï¼š

publicï¼ˆæˆ– externalï¼‰å‡½æ•°éƒ½æœ‰ä¸€ä¸‹æˆå‘˜ï¼š
- .address: è¿”å›å‡½æ•°çš„åˆçº¦åœ°å€
- .selectorï¼šè¿”å›ABIå‡½æ•°é€‰æ‹©å™¨

**å¦‚ä½•ä½¿ç”¨æˆå‘˜**

```solidity
// SPDX-License-Identifier: MIT

pragma solidity ^0.8.8;

contract test {
  function f() public payable returns (bytes4) {
      assert(this.f.address == address(this));
      return this.f.selector;
  }
  function g() public {
      this.f{gas: 10, value: 1}();
  }
}
```
**å¦‚ä½•ä½¿ç”¨å†…éƒ¨å‡½æ•°ç±»å‹**

```solidity
// SPDX-License-Identifier: MIT

pragma solidity ^0.8.8;

library ArrayUtils {
  // å†…éƒ¨å‡½æ•°å¯ä»¥åœ¨å†…éƒ¨åº“å‡½æ•°ä¸­ä½¿ç”¨
  // å› ä¸ºä»–ä»¬ä¼šæˆä¸ºåŒä¸€ä»£ç ä¸Šä¸‹æ–‡çš„ä¸€éƒ¨åˆ†
  function map(
      uint256[] memory self, 
      function (uint256) pure returns (uint256) f
  )
      internal
      pure
      returns (uint256[] memory r)
  {
      r = new uint256[](self.length);
      for(uint256 i = 0; i < self.length; i++) {
          r[i] = f(self[i]);
      }
  }

  function reduce(
      uint256[] memory self,
      function (uint256, uint256) pure returns (uint256) f
  )
      internal
      pure
      returns (uint256 r)
  {
      r = self[0];
      for(uint256 i = 0; i < self.length; i++) {
          r = f(r, self[i]);
      }
  }

  function range(uint256 length) internal pure returns (uint256[] memory r) {
      r = new uint256[](length);
      for(uint256 i = 0; i < r.length; i++) {
          r[i] = i;
      }
  }
}

contract Pyramid {
    
  using ArrayUtils for *;

  function pyramid(uint256 _l) public pure returns(uint256) {
      return ArrayUtils.range(_l).map(squre).reduce(sum);
  }
  function squre(uint256 _x) internal pure returns (uint256) {
      return _x * _x;
  }
  function sum(uint256 _x, uint256 _y) internal pure returns (uint256) {
      return _x + _y;
  }
}
```

**å¦‚ä½•ä½¿ç”¨å¤–éƒ¨å‡½æ•°ç±»å‹**

```solidity
// SPDX-License-Identifier: MIT

pragma solidity ^0.8.8;

contract Oracle {

  struct Request {
      bytes data;
      function(uint256) external callback;
  }

  Request[] private requests;

  event NewRequest(uint);

  function query(bytes memory data, function(uint256) external callback) public {
      requests.push(Request(data, callback));
      emit NewRequest(requests.length - 1);
  }
  function reply(uint256 requestID, uint256 response) public {
      // è¿™é‡Œæ£€æŸ¥å›å¤æ¥è‡ªå¯ä¿¡æ¥æº
      requests[requestID].callback(response);
  }
}

contract OracleUser {
  Oracle constant private ORACLE_CONST = Oracle(address(0x00000000219ab540356cBB839Cbe05303d7705Fa));

  uint256 private exchangeRate;

  function buySomething() public {
      ORACLE_CONST.query("USD", this.oracleResponse);
  }

  function oracleResponse(uint256 response) public {
      require(
          msg.sender == address(ORACLE_CONST),
          "Only oracle can call this"
      );
      exchangeRate = response;
  }
}
```

#### 2ã€å¼•ç”¨ç±»å‹

ä½¿ç”¨å¼•ç”¨ç±»å‹ï¼Œå¿…é¡»æ˜ç¡®æŒ‡æ˜æ•°æ®å­˜å‚¨åœ¨å“ªç§ç±»å‹çš„ç©ºé—´ï¼ˆä½ç½®ï¼‰é‡Œã€‚

- `memory` ï¼š å†…å­˜ï¼Œæ•°æ®ä»…åœ¨å…¶ç”Ÿå‘½å‘¨æœŸå†…ï¼ˆå‡½æ•°è°ƒç”¨æœŸé—´ï¼‰æœ‰æ•ˆã€‚ä¸èƒ½ç”¨äºå¤–éƒ¨è°ƒç”¨
- `storage` ï¼š å­˜å‚¨ï¼Œåªè¦åˆçº¦å­˜åœ¨å°±ä¸€ç›´å­˜å‚¨
- `calldata` ï¼šè°ƒç”¨æ•°æ®ï¼Œç”¨æ¥ä¿å­˜å‡½æ•°å‚æ•°çš„ç‰¹æ®Šæ•°æ®ä½ç½®ï¼Œæ˜¯ä¸€ä¸ªåªè¯»ä½ç½®

> æ›´æ”¹æ•°æ®ä½ç½®æˆ–ç±»å‹è½¬æ¢å°†å§‹ç»ˆäº§ç”Ÿè‡ªåŠ¨è¿›è¡Œä¸€ä»½æ‹·è´ï¼Œè€Œåœ¨åŒä¸€æ•°æ®ä½ç½®å†…ï¼ˆå¯¹ç”¨å­˜å‚¨`storage`æ¥è¯´ï¼‰çš„å¤åˆ¶ä»…åœ¨æŸäº›æƒ…å†µä¸‹è¿›è¡Œæ‹·è´ã€‚

##### 2-1ã€æ•°æ®ä½ç½®

æ‰€æœ‰çš„å¼•ç”¨ç±»å‹ï¼Œéƒ½æœ‰ä¸€ä¸ªé¢å¤–æ³¨è§£`æ•°æ®ä½ç½®`ï¼Œæ¥è¯´æ˜æ•°æ®å­˜å‚¨ä½ç½®ï¼ŒåŒ…æ‹¬å†…å­˜`memory`ã€å­˜å‚¨`storage`å’Œè°ƒç”¨æ•°æ®`calldata`ã€‚è°ƒç”¨æ•°æ®`calldata`æ˜¯ä¸å¯ä¿®æ”¹çš„ã€éæŒä¹…çš„å‡½æ•°å‚æ•°å­˜å‚¨åŒºåŸŸï¼Œæ•ˆæœå¤§å¤šç±»ä¼¼å†…å­˜`memory`ã€‚ä¸»è¦ç”¨äºå¤–éƒ¨å‡½æ•°çš„å‚æ•°ï¼Œä¹Ÿå¯ç”¨äºå…¶ä»–å˜é‡ã€‚

> å¦‚æœå¯ä»¥çš„è¯ï¼Œå°½é‡ä½¿ç”¨`calldata`ä½œä¸ºæ•°æ®ä½ç½®ï¼Œå› ä¸ºå®ƒå°†é¿å…å¤åˆ¶ï¼Œå¹¶ç¡®ä¿ä¸èƒ½ä¿®æ”¹æ•°æ®ã€‚

æ•°æ®ä½ç½®ä¸ä»…ä»…è¡¨ç¤ºæ•°æ®å¦‚ä½•å­˜å‚¨ï¼Œå®ƒåŒæ ·å½±å“ç€èµ‹å€¼è¡Œä¸ºï¼š

- 1ã€åœ¨å­˜å‚¨å’Œå†…å­˜ä¹‹é—´äº’ç›¸èµ‹å€¼ï¼Œéƒ½ä¼šåˆ›å»ºä¸€ä»½ç‹¬ç«‹æ‹·è´
- 2ã€ä»å†…å­˜åˆ°å†…å­˜çš„èµ‹å€¼ï¼Œåªåˆ›å»ºå¼•ç”¨ï¼Œè¿™æ„å‘³ç€æ›´æ”¹å†…å­˜å˜é‡ï¼Œå…¶ä»–å¼•ç”¨ç›¸åŒæ•°æ®çš„æ‰€æœ‰å…¶ä»–å†…å­˜å˜é‡çš„å€¼ä¹Ÿä¼šå‘ç”Ÿå˜åŒ–
- 3ã€ä»å­˜å‚¨åˆ°æœ¬åœ°å­˜å‚¨å˜é‡çš„èµ‹å€¼å€¼åˆ†é…ä¸€ä¸ªå¼•ç”¨
- 4ã€å…¶ä»–å‘å­˜å‚¨çš„èµ‹å€¼ï¼Œæ€»æ˜¯è¿›è¡Œæ‹·è´

```solidity
// SPDX-License-Identifier: GPL-3.0

pragma solidity ^0.8.0

contract Tiny {

  uint[] x; // xä¸ºstorage

  function f(uint[] memory memoryArray) public {
    x = memoryArray; // ç¬¬ä¸€æ¡ï¼Œmemory -> storage è¿›è¡Œæ‹·è´
    uint[] storage y = x; // storage -> storage è¿›è¡Œå¼•ç”¨
    y[7]; // è¿”å›ç¬¬å…«ä¸ªå…ƒç´ 
    y.pop(); // åˆ é™¤æœ€åä¸€ä¸ªå…ƒç´ ï¼Œä¿®æ”¹yåŒæ—¶ä¿®æ”¹x
    delete x; // æ¸…é™¤æ•°ç»„ï¼ŒåŒæ—¶ä¿®æ”¹y
    delete y; // è¿™ä¼šé‡ç½®æŒ‡é’ˆï¼Œä¸å¯è¡Œ
    y = memoryArray; // ä¸å¯è¡Œ
  }
}
```

##### 2-2ã€æ•°ç»„

æ•°ç»„å¯ä»¥åœ¨å£°æ˜æ—¶æŒ‡å®šé•¿åº¦ï¼Œä¹Ÿå¯ä»¥åŠ¨æ€è°ƒæ•´å¤§å°ï¼ˆé•¿åº¦ï¼‰ã€‚

å£°æ˜æ–¹å¼ä¸ºï¼š`T[K]`ï¼ˆç±»å‹ä¸ºTï¼Œé•¿åº¦ä¸ºKï¼‰ï¼Œ`T[]`ï¼ˆç±»å‹ä¸ºTï¼Œé•¿åº¦ä¸å›ºå®šï¼ŒåŠ¨æ€æ•°ç»„ï¼‰ï¼Œ`T[][K]`ï¼ˆé•¿åº¦ä¸ºKï¼Œç±»å‹ä¸ºTçš„åŠ¨æ€æ•°ç»„ï¼ŒäºŒç»´æ•°ç»„ï¼Œä¾‹å¦‚è®¿é—®ç¬¬ä¸‰ä¸ªåŠ¨æ€æ•°ç»„çš„ç¬¬ä¸ƒä¸ªå…ƒç´ ï¼Œä¸º`x[2][6]`ï¼‰

æ•°ç»„å…ƒç´ å¯ä»¥æ˜¯ä»»ä½•ç±»å‹ï¼Œå¯¹ç±»å‹çš„é™åˆ¶æ˜¯æ˜ å°„åªèƒ½åœ¨`storage`ä¸­ï¼Œå¹¶ä¸”å…¬å¼€è®¿é—®å‡½æ•°çš„å‚æ•°éœ€è¦æ˜¯`ABI`ç±»å‹

çŠ¶æ€å˜é‡æ ‡è®°ä¸º`public`çš„æ•°ç»„ï¼Œä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ª`getter`å‡½æ•°ï¼Œæ•°å­—ç´¢å¼•æ˜¯è¿™ä¸ªå‡½æ•°çš„å‚æ•°

è®¿é—®è¶…å‡ºæ•°ç»„é•¿åº¦çš„å…ƒç´ ä¼šå¯¼è‡´å¼‚å¸¸ã€‚å¯ä»¥ä½¿ç”¨`.push()`æ–¹æ³•åœ¨æœ«å°¾è¿½åŠ ä¸€ä¸ªé›¶åˆå§‹åŒ–çš„æ–°å…ƒç´ å¹¶è¿”å›å¯¹å®ƒçš„å¼•ç”¨

###### bytes å’Œ string ä¹Ÿæ˜¯æ•°ç»„

`bytes` ç±»ä¼¼äº `bytes1[]`ï¼Œä½†å®ƒåœ¨è°ƒç”¨æ•°æ®å’Œå†…å­˜ä¸­ä¼šè¢«â€œç´§æ‰“åŒ…â€ã€‚æ›´å¤šæ—¶å€™åº”è¯¥ä½¿ç”¨`bytes`ï¼Œgasè´¹ç”¨æ›´ä½ã€‚ä½¿ç”¨é•¿åº¦é™åˆ¶çš„å­—èŠ‚æ•°ç»„ï¼Œåº”è¯¥ä½¿ç”¨`bytes1`åˆ°`bytes32`çš„å…·ä½“ç±»å‹ã€‚

`string`ä¸å…è®¸ç”¨é•¿åº¦æˆ–ç´¢å¼•æ¥è®¿é—®ï¼Œæ¯”è¾ƒä¸¤ä¸ªå­—ç¬¦ä¸²é€šè¿‡è®¡ç®—ä»–ä»¬çš„`keccak256-hash`æ¥æ¯”è¾ƒï¼š`keccak256(abi.encodePacked(s1)) == keccak256(abi.encodePacked(s2))`ï¼Œä½¿ç”¨ `string.concat(s1,s2)`æ¥æ‹¼æ¥ä¸¤ä¸ªå­—ç¬¦ä¸²

> å¦‚æœè¦è®¿é—®ä»¥å­—èŠ‚è¡¨ç¤ºçš„å­—ç¬¦ä¸²sï¼Œå¯ä»¥ä½¿ç”¨`bytes(s).length / bytes(s)[7] = 'x'`

###### å‡½æ•° bytes.concat å’Œ string.concat

- `string.concat`ï¼šè¿æ¥ä»»æ„æ•°é‡çš„ `string` å­—ç¬¦ä¸²ã€‚è¿”å›ä¸€ä¸ª `string memory`
- `bytes.concat`ï¼šè¿æ¥ä»»æ„æ•°é‡çš„ `bytes` æˆ– `bytes1 ... bytes32` å€¼ã€‚è¿”å›ä¸€ä¸ª `bytes memory`ã€‚
- å¦‚æœä¸ä½¿ç”¨å‚æ•°è°ƒç”¨è¿™ä¸¤ä¸ªå‡½æ•°ï¼Œå°†è¿”å›ç©ºæ•°ç»„ï¼ˆç©ºå­—ç¬¦ä¸²å’Œ0xï¼‰

```solidity
// SPDX-License-Identifier: MIT

pragma solidity ^0.8.12;

contract Concat {
  string s = "Storage";

  function c(bytes calldata bc, string memory sm, bytes2 b)
    public 
    view 
    returns (string memory, bytes memory, uint256, uint256) 
  {
    string memory concatString = string.concat(s, string(bc), sm);
    bytes memory concatBytes = bytes.concat(bytes(s), bc, bytes(sm), b);
    return (concatString, concatBytes, bytes(concatString).length, concatBytes.length);
  }
}
```

###### æ•°ç»„å¸¸é‡

æ•°ç»„å¸¸é‡æ˜¯åœ¨æ–¹æ‹¬å·ä¸­ï¼ˆ`[...]`ï¼‰åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªé€—å·åˆ†éš”çš„è¡¨è¾¾å¼ï¼Œä¾‹å¦‚`[1, a, f(3)]`ã€‚

æ•°ç»„å¸¸é‡çš„ç±»å‹é€šè¿‡ä»¥ä¸‹æ–¹å¼ç¡®å®š

- æ•°ç»„å¸¸é‡æ€»æ˜¯ä¸€ä¸ªé™æ€å¤§å°çš„å†…å­˜æ•°ç»„ï¼Œå…¶é•¿åº¦ä¸ºè¡¨è¾¾å¼çš„æ•°é‡ã€‚
- æ•°ç»„çš„åŸºæœ¬ç±»å‹æ˜¯ç¬¬ä¸€ä¸ªè¡¨è¾¾å¼çš„ç±»å‹ï¼Œæ•°ç»„çš„å…¨éƒ¨å…ƒç´ éœ€è¦è½¬æ¢æˆç›¸åŒç±»å‹
- å®šé•¿çš„å†…å­˜æ•°ç»„ä¸èƒ½èµ‹å€¼ç»™å˜é•¿çš„å†…å­˜æ•°ç»„

###### æ•°ç»„æˆå‘˜

- `length`ï¼šå½“å‰æ•°ç»„é•¿åº¦
- `push()`ï¼šåŠ¨æ€çš„å­˜å‚¨æ•°ç»„ä»¥åŠ`bytes`ç±»å‹éƒ½æœ‰è¿™ä¸ªæˆå‘˜å‡½æ•°ï¼Œå®ƒæ·»åŠ æ–°çš„é›¶åˆå§‹åŒ–å…ƒç´ åˆ°æ•°ç»„æœ«å°¾ï¼Œå¹¶è¿”å›è¯¥å…ƒç´ çš„å¼•ç”¨
- `push(x)`ï¼šåŠ¨æ€çš„å­˜å‚¨æ•°ç»„ä»¥åŠ`bytes`ç±»å‹éƒ½æœ‰è¿™ä¸ªæˆå‘˜å‡½æ•°ï¼Œå®ƒæ·»åŠ æ–°çš„å…ƒç´ åˆ°æ•°ç»„æœ«å°¾ï¼Œæ²¡æœ‰è¿”å›å€¼
- `pop)`ï¼šåŠ¨æ€çš„å­˜å‚¨æ•°ç»„ä»¥åŠ`bytes`ç±»å‹éƒ½æœ‰è¿™ä¸ªæˆå‘˜å‡½æ•°ï¼Œå®ƒç§»é™¤æ•°ç»„æœ«å°¾å…ƒç´ ï¼ŒåŒæ ·ä¼šåœ¨ç§»é™¤çš„å…ƒç´ ä¸Šéšå«è°ƒç”¨ `delete`ï¼Œ æ²¡æœ‰è¿”å›å€¼

```solidity
// SPDX-License-Identifier: MIT

pragma solidity ^0.8.12;

contract ArrayContract {
  // storage é•¿åº¦ä¸º 2**20 çš„ uint æ•°ç»„
  uint256[2**20] public aLotOfIntegers;

  // è¯¥å˜é‡ä¸ºç±»å‹æ˜¯åŒ…å«2ä¸ªboolç±»å‹å®šé•¿æ•°ç»„çš„åŠ¨æ€æ•°ç»„
  bool[2][] public pairsOfFlags;

  function setAllFlagPairs(bool[2][] memory newPairs) public {
      // å†…å­˜å‘å­˜å‚¨èµ‹å€¼ï¼Œè¿›è¡Œæ‹·è´ï¼ŒnewPairs æ›¿æ¢æ•´ä¸ª pairsOfFlags
      pairsOfFlags = newPairs;
  }

  // ç»“æ„ä½“ï¼ŒåŒ…å«ä¸€ä¸ªuintæ•°ç»„ï¼Œä¸€ä¸ªuint
  struct structType{
      uint256[] contents;
      uint256 moreInfo;
  }
  // å£°æ˜ä¸€ä¸ªç»“æ„ä½“å˜é‡
  structType public s;

  function f(uint256[] memory c) public {
      // ä»å­˜å‚¨åˆ°æœ¬åœ°å­˜å‚¨å˜é‡çš„èµ‹å€¼åˆ†é…ä¸€ä¸ªå¼•ç”¨
      structType storage g = s;
      // gå’ŒsåŒæ—¶æ”¹å˜
      g.moreInfo = 2;
      // æ‹·è´ï¼Œå› ä¸º g.contents ä¸æ˜¯æœ¬åœ°å˜é‡ï¼Œä»–æ˜¯æœ¬åœ°å˜é‡çš„æˆå‘˜
      g.contents = c;
  }

  function setFlagPairs(uint256 index, bool flagA, bool flagB) public {
      // è®¿é—®ä¸å­˜åœ¨çš„ç´¢å¼•å°†ä¼šå¼•å‘å¼‚å¸¸
      // ç»™pairsOfFlagsç¬¬indexé¡¹çš„ç¬¬ä¸€ä¸ªèµ‹å€¼ä¸ºflagA
      pairsOfFlags[index][0] = flagA;
      // ç»™pairsOfFlagsç¬¬indexé¡¹çš„ç¬¬äºŒä¸ªèµ‹å€¼ä¸ºflagB
      pairsOfFlags[index][1] = flagB;
  }

  function changeFlagArraySize(uint256 newSize) public {
      // ä½¿ç”¨ push å’Œ pop æ˜¯æ›´æ”¹æ•°ç»„é•¿åº¦çš„å”¯ä¸€æ–¹æ³•
      if(newSize > pairsOfFlags.length) {
          while(pairsOfFlags.length < newSize)
              pairsOfFlags.push();
      } else if(newSize < pairsOfFlags.length) {
          while(pairsOfFlags.length > newSize)
              pairsOfFlags.pop();
      }
  }

  function clear() public {
      // å®Œå…¨æ¸…é™¤æ•°ç»„
      delete pairsOfFlags;
      delete aLotOfIntegers;
      // æ•ˆæœå’Œä¸Šé¢ç›¸åŒ
      // pairsOfFlags.length = new bool[2][](0)
  }

  bytes public bytesData;

  function byteArrays(bytes memory data) public {
      bytesData = data;
      for(uint256 i = 0; i < 7; i++)
          bytesData.push();
      bytesData[3] = 0x67;
      delete bytesData[2];
  }

  function addFlag(bool[2] memory flag) public returns (uint256) {
      pairsOfFlags.push(flag);
      return pairsOfFlags.length;
  }

  function createMemoryArray(uint256 size) public pure returns(bytes memory) {
      // ä½¿ç”¨newåˆ›å»ºåŠ¨æ€å†…å­˜æ•°ç»„
      uint256[2][] memory arrayOfPairs = new uint256[2][](size);
      // å…§è”æ•°ç»„å§‹ç»ˆæ˜¯é™æ€å¤§å°çš„ï¼Œå¦‚æœä½¿ç”¨å­—é¢å¸¸é‡ï¼Œå¿…é¡»è‡³å°‘æé«˜ä¸€ç§ç±»å‹
      arrayOfPairs[0] = [uint256(1), 2];
      // åˆ›å»ºä¸€ä¸ªåŠ¨æ€å­—èŠ‚æ•°ç»„
      bytes memory b = new bytes(size);
      for(uint256 i = 0; i < b.length; i++)
          b[i] = bytes1(uint8(i));
      return b;
  }
}
```

###### å¯¹å­˜å‚¨æ•°ç»„å…ƒç´ çš„æ‚¬ç©ºå¼•ç”¨

æ‚¬ç©ºå¼•ç”¨æ˜¯æŒ‡ä¸€ä¸ªæŒ‡å‘ä¸å†å­˜åœ¨çš„ä¸œè¥¿çš„å¼•ç”¨ï¼Œæˆ–è€…æ˜¯å¯¹è±¡è¢«ç§»é™¤è€Œæ²¡æœ‰æ›´æ–°å¼•ç”¨ã€‚

```solidity
// SPDX-License-Identifier: MIT

pragma solidity ^0.8.12;

contract c {
  uint256[][] public s;

  function f() public {
      s.push();
      // ä¿å­˜æ•°ç»„æœ€åä¸€ä¸ªå…ƒç´ çš„å¼•ç”¨
      uint256[] storage ptr = s[s.length - 1];
      // ç§»é™¤æœ€åä¸€ä¸ªå…ƒç´ 
      s.pop();
      // å‘ä¸å†å±äºæ•°ç»„çš„å…ƒç´ å†™å…¥æ•°æ®
      ptr.push(0x42);
      // ç°åœ¨æ·»åŠ å…ƒç´ åˆ°sä¸ä¼šæ·»åŠ ä¸€ä¸ªç©ºå…ƒç´ ï¼Œè€Œæ˜¯æ•°ç»„é•¿åº¦ä¸º1ï¼Œ0x42ä½œä¸ºå…¶å…ƒç´ 
      s.push();
      assert(s[s.length - 1][0] == 0x42);
  }
}
```

`solidity`ä¸å…è®¸åœ¨å­˜å‚¨ä¸­å£°æ˜å¯¹å€¼ç±»å‹çš„å¼•ç”¨ã€‚è¿™äº›æ˜ç¡®çš„æ‚¬ç©ºå¼•ç”¨è¢«é™åˆ¶åœ¨åµŒå¥—å¼•ç”¨ç±»å‹ä¸­ã€‚ç„¶è€Œï¼Œæ‚¬ç©ºå¼•ç”¨ä¹Ÿå¯èƒ½åœ¨å…ƒç»„èµ‹å€¼ä¸­ä½¿ç”¨å¤æ‚è¡¨å•Šæ˜¯æ—¶ä¸´æ—¶å‘ç”Ÿã€‚

```solidity
// SPDX-License-Identifier: MIT

pragma solidity ^0.8.12;

contract c {
  uint256[] public s;
  uint256[] public t;

  constructor() {
      s.push();
      t.push();
  }
  function g() internal returns (uint256[] storage) {
      s.pop();
      return t;
  }
  function f() public returns (uint256[] memory) {
      // å…ˆæ‰§è¡Œ s.push() ï¼Œå¹¶è·å¾—å…ƒç´  1 çš„å¼•ç”¨
      // ç„¶åï¼Œè°ƒç”¨ gï¼Œpopç§»é™¤è¿™ä¸ªå¼•ç”¨,å·¦è¾¹çš„å…ƒç»„å…ƒç´ æˆäº†æ‚¬ç©ºå¼•ç”¨
      // èµ‹å€¼ä»ä¼šå‘ç”Ÿï¼Œä¼šè¢«å†™å…¥sä¹‹å¤–çš„æ•°æ®åŒºåŸŸ
      (s.push(), g()[0]) = (0x42, 0x17);
      // s.push()ä½¿ç”¨ä¸Šä¸€ä¸ªè¯­å¥çš„å€¼
      // sçš„æœ€åä¸€ä¸ªå…ƒç´ ä¸º0x42
      s.push();
      return s;
      // æ‰§è¡Œå®Œä¹‹å
      // s => 0,0x42
      // t => 0x17
  }
}
```
åœ¨å¤„ç†å¯¹`bytes`æ•°ç»„å…ƒç´ çš„å¼•ç”¨æ—¶ï¼Œè¦ç‰¹åˆ«å°å¿ƒï¼Œå› ä¸ºå­—èŠ‚æ•°ç»„ä¸Šçš„`.push()`å¯èƒ½ä¼šå‘ç”Ÿå­˜å‚¨ä»çŸ­åˆ°é•¿å¸ƒå±€çš„åˆ‡æ¢

```solidity
// SPDX-License-Identifier: MIT

pragma solidity ^0.8.12;

contract c {
  bytes public x = "012345678901234567890123456789";

  function test() public returns(uint256) {
      (x.push(), x.push()) = (0x01, 0x02);
      return x.length;
  }

  function getLength() public view returns(uint256) {
      return x.length;
  }

  // åˆšå¼€å§‹ï¼š
  // x => 0x303132333435363738393031323334353637383930313233343536373839
  // x.length => 30
  // æ‰§è¡Œtestå
  // x => 0x30313233343536373839303132333435363738393031323334353637383900020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
  // x.length => 160
  // ç»§ç»­æ‰§è¡Œtestå
  // x => 0x303132333435363738393031323334353637383930313233343536373839000200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000102
  // x.length => 162
}
```

è¿™é‡Œç¬¬ä¸€ä¸ª`x.push()`æ‰§è¡Œåï¼Œxä»ç„¶è¢«å­˜å‚¨åœ¨çŸ­çš„å¸ƒå±€ä¸­ï¼Œç¬¬äºŒä¸ª`x.push()`å°†å­—èŠ‚æ•°ç»„åˆ‡æ¢ä¸ºé•¿å¸ƒå±€ã€‚å› æ­¤ï¼Œåœ¨ä¸€æ¬¡èµ‹å€¼ä¸­æœ€å¤šåªæ‰©å¤§å­—èŠ‚æ•°ç»„ä¸­çš„ä¸€ä¸ªå…ƒç´ ã€‚

##### 2-3ã€æ•°ç»„åˆ‡ç‰‡

æ•°ç»„åˆ‡ç‰‡æ˜¯æ•°ç»„è¿ç»­éƒ¨åˆ†çš„è§†å›¾ï¼Œç”¨æ³•å¦‚`x[start:end]`ï¼Œ`start` å’Œ `end` æ˜¯ `uint256` ç±»å‹ï¼ˆæˆ–ç»“æœæ˜¯`uint256`çš„è¡¨è¾¾å¼ï¼‰ã€‚`x[start:end]`çš„ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯`x[start]`ï¼Œæœ€åä¸€ä¸ªå…ƒç´ æ˜¯`x[end - 1]`ã€‚

å¦‚æœ`start` æ¯” `end` å¤§ï¼Œæˆ–è€… `end` æ¯”æ•°ç»„é•¿åº¦å¤§ï¼Œå°†ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚

`start` å’Œ `end` éƒ½æ˜¯å¯é€‰çš„ï¼Œ`start` é»˜è®¤æ˜¯ 0ï¼Œ `end` é»˜è®¤æ˜¯æ•°ç»„é•¿åº¦ã€‚

> æ•°ç»„åˆ‡ç‰‡æ²¡æœ‰ä»»ä½•æˆå‘˜ã€‚ä»–ä»¬å¯ä»¥éšå¼è½¬æ¢ä¸ºå…¶èƒŒåçš„ç±»å‹ï¼Œå¹¶æ”¯æŒç´¢å¼•è®¿é—®ã€‚ç´¢å¼•è®¿é—®ä¹Ÿæ˜¯ç›¸å¯¹äºåˆ‡ç‰‡çš„å¼€å§‹ä½ç½®ã€‚æ•°ç»„åˆ‡ç‰‡æ²¡æœ‰ç±»å‹åç§°ï¼Œè¿™æ„å‘³ç€æ²¡æœ‰å˜é‡å¯ä»¥å°†æ•°ç»„åˆ‡ç‰‡ä½œä¸ºç±»å‹ã€‚ä»–ä»¬ä»…å­˜åœ¨äºä¸­é—´è¡¨è¾¾å¼ä¸­ã€‚
> **ç›®å‰æ•°ç»„åˆ‡ç‰‡ï¼Œä»…å¯ç”¨äº `calldata` æ•°ç»„**

```solidity
function f(bytes calldata payload) public {
  // å–å‰å››ä½
  bytes4 sig = bytes4(payload[:4]);
  // ç”±äºæˆªæ–­è¡Œä¸ºï¼Œç›¸å½“äº
  // bytes4 sig = bytes4(payload);
}
```

##### 2-4ã€ç»“æ„ä½“

é€šè¿‡ç»“æ„ä½“çš„å½¢å¼å¯ä»¥å®šä¹‰æ–°çš„ç±»å‹ã€‚

```solidity
//SPDX-License-Identifier: MIT

pragma solidity ^0.8.0;

// åœ¨åˆçº¦å¤–éƒ¨å®šä¹‰çš„ç»“æ„ä½“å¯ä»¥ä½¿å…¶è¢«å¤šä¸ªåˆçº¦å…±äº«
// æä¾›èµ„é‡‘çš„äºº
struct Funder {
    address addr;
    uint amount;
}
// ä¼—ç­¹åˆçº¦
contract CrowdFunding {
  // åœ¨åˆçº¦å†…éƒ¨å®šä¹‰çš„ç»“æ„ä½“å¯ä»¥ä½¿å…¶åœ¨æ­¤åˆçº¦å’Œè¡ç”Ÿåˆçº¦ä¸­å¯è§
  // æ´»åŠ¨
  struct Campaign {
      address payable beneficiary; // å—ç›Šäºº
      uint fundingGoal; // ç­¹é›†ç›®æ ‡
      uint numFunders; // æä¾›èµ„é‡‘çš„äººæ•°
      uint amount; // å®é™…é‡‘é¢
      mapping (uint => Funder) funders; // æä¾›èµ„é‡‘çš„äºº
  }

  uint numCampaigns; // æ´»åŠ¨æ•°é‡

  mapping (uint => Campaign) campaigns;
  // åˆ›å»ºä¸€ä¸ªæ–°çš„æ´»åŠ¨
  function newCampaign(address payable _beneficiary, uint _goal) 
      public 
      returns (uint campaignID) 
  {
      // campaignIDä½œä¸ºä¸€ä¸ªå˜é‡è¿”å›ï¼Œæ´»åŠ¨çš„æ•°é‡åŠ ä¸€
      campaignID = numCampaigns++;
      // ä¸èƒ½ä½¿ç”¨ä¸‹æ–¹è¿™ä¸ªæ–¹å¼ï¼Œå› ä¸ºå³è¾¹ä¼šåˆ›å»ºä¸€ä¸ªåŒ…å«æ˜ å°„çš„å†…å­˜ç»“æ„ä½“Campaignï¼Œæ˜ å°„åªèƒ½æ˜¯å­˜å‚¨`storage`çš„æ•°æ®ä½ç½®
      // campaigns[campaignID] = Campaign(_beneficiary, _goal, 0, 0)
      Campaign storage c = campaigns[campaignID];
      c.beneficiary = _beneficiary;
      c.fundingGoal = _goal;
  }
  // æçŒ®å‡½æ•°
  function contribute(uint campaignID) public payable {
      // æ‹¿åˆ°æ´»åŠ¨
      Campaign storage c = campaigns[campaignID];
      // æ·»åŠ æ´»åŠ¨æçŒ®äºº
      c.funders[c.numFunders++] = Funder({addr: msg.sender, amount: msg.value});
      // æ·»åŠ æ´»åŠ¨çš„æçŒ®é‡‘é¢
      c.amount += msg.value;
  }
  // æ£€æŸ¥æ˜¯å¦è¾¾åˆ°ç›®æ ‡
  function checkGoalReached(uint campaignID) public returns(bool reached) {
      Campaign storage c = campaigns[campaignID];
      if(c.amount < c.fundingGoal)
          return false;
      // è¾¾åˆ°ç›®æ ‡ï¼Œå‘é€å‡ºå»
      uint amount = c.amount;
      c.amount = 0;
      c.beneficiary.transfer(amount);
      return true;
  }
} 
```

ç»“æ„ä½“å¯ä»¥ä½œä¸ºå…ƒç´ ç”¨åœ¨æ˜ å°„å’Œæ•°ç»„ä¸­ï¼Œå…¶è‡ªèº«ä¹Ÿå¯ä»¥åŒ…å«æ˜ å°„å’Œæ•°ç»„ä½œä¸ºæˆå‘˜å˜é‡ã€‚åœ¨å‡½æ•°ä¸­ä½¿ç”¨æ—¶ï¼Œä¸€ä¸ªç»“æ„ä½“è¢«èµ‹å€¼ç»™ä¸€ä¸ªå­˜å‚¨`storage`çš„å±€éƒ¨å˜é‡æ—¶ï¼Œåªæ˜¯ä¿å­˜ä¸€ä¸ªå¼•ç”¨ã€‚

##### 2-5ã€æ˜ å°„

æ˜ å°„ç±»å‹çš„å£°æ˜æ–¹å¼æ˜¯ï¼š`mapping (keyType => valueType)`ã€‚å…¶ä¸­ `keyType`æ˜¯ï¼šä»»ä½•çš„å†…å»ºç±»å‹ï¼Œ`bytes``string`æˆ–åˆçº¦ç±»å‹ã€æšä¸¾ç±»å‹ï¼›`valueType`å¯ä»¥æ˜¯åŒ…å«æ˜ å°„ç±»å‹åœ¨å†…çš„ä»»ä½•ç±»å‹ã€‚

æ˜ å°„åœ¨å®é™…çš„åˆå§‹åŒ–è¿‡ç¨‹ä¸­ä¼šåˆ›å»ºæ¯ä¸ªå¯èƒ½çš„`key`ï¼Œå¹¶å°†å…¶æ˜ å°„åˆ°å­—èŠ‚å½¢å¼å…¨æ˜¯é›¶çš„å€¼ï¼ˆä¸€ä¸ªç±»å‹çš„é»˜è®¤å€¼ï¼‰ã€‚åœ¨æ˜ å°„ä¸­ï¼Œå®é™…ä¸Šå¹¶ä¸å­˜å‚¨`key`ï¼Œè€Œæ˜¯å­˜å‚¨å®ƒçš„`keccak256`å“ˆå¸Œå€¼ï¼Œä»è€Œæ–¹ä¾¿æŸ¥è¯¢å®é™…çš„å€¼ã€‚å› æ­¤ï¼Œæ˜ å°„æ˜¯æ²¡æœ‰é•¿åº¦çš„ï¼Œä¹Ÿæ²¡æœ‰`key`çš„é›†åˆæˆ–`value`çš„é›†åˆ.

æ˜ å°„åªèƒ½æ˜¯å­˜å‚¨`storage`çš„æ•°æ®ä½ç½®ï¼Œå› æ­¤åªå…è®¸ä½œä¸ºçŠ¶æ€å˜é‡æˆ–å‡½æ•°å†…çš„å­˜å‚¨`storage`å¼•ç”¨æˆ–ä½œä¸ºåº“å‡½æ•°çš„å‚æ•°ï¼Œä¸èƒ½ç”¨äºåˆçº¦å…¬æœ‰å‡½æ•°çš„å‚æ•°æˆ–è¿”å›å€¼ã€‚è¿™äº›é™åˆ¶åŒæ ·é€‚ç”¨äºåŒ…å«æ˜ å°„çš„æ•°ç»„æˆ–ç»“æ„ä½“ã€‚

```solidity
//SPDX-License-Identifier: MIT

pragma solidity ^0.8.0;

contract MappingExample {
  // è´¦æˆ·ä½™é¢
  mapping (address => uint256) private _balances;
  // å…¶ä»–äººå¯ä»¥ä½¿ç”¨æˆ‘çš„è´¦å·çš„å¤šå°‘é’±
  mapping (address => mapping (address => uint256)) private _allowances;
  // ä» -ã€‹ åˆ°
  event Transfer(address indexed from, address indexed to, uint256 value);
  // æ‹¥æœ‰è€… -ã€‹ æ¥æ”¶è€…
  event Approval(address indexed owner, address indexed spender, uint256 value);

  function allowance(address owner, address spender) public view returns (uint256) {
      // è¿”å›ç”¨é’±çš„äººå¯ä»¥ä½¿ç”¨æˆ‘çš„è´¦å·çš„å¤šå°‘é’±
      return _allowances[owner][spender];
  }

  function transferFrom(address sender, address recipient, uint256 amount) public returns (bool) {
      // å½“å‰è°ƒç”¨çš„äººå¯ä»¥ä½¿ç”¨å‘é€è€…çš„é’±çš„æ•°é‡å¿…é¡» >= éœ€è¦ä½¿ç”¨çš„æ•°é‡
      require(_allowances[sender][msg.sender] >= amount, "ERC20: Allowance not high enough");
      // è½¬ç§»é’±
      _allowances[sender][msg.sender] -= amount;
      _transfer(sender, recipient, amount);
      return true;
  } 

  function approve(address spender, uint256 amount) public returns (bool) {
      require(spender != address(0), "ERC20: approve to the zero address");
      // å½“å‰è°ƒç”¨äººç»™ç”¨é’±çš„äººæä¾›é’±
      _allowances[msg.sender][spender] = amount;
      // è§¦å‘æä¾›äº‹ä»¶
      emit Approval(msg.sender, spender, amount);
      return true;
  }

  function _transfer(address sender, address recipient, uint256 amount) internal {
      require(sender != address(0), "ERC20: transfer from the zero address");
      require(recipient != address(0), "ERC20: transfer to the zero address");
      // å‘é€çš„äººçš„é’±å¿…é¡»å¤Ÿ
      require(_balances[sender] >= amount, "ERC20: Not enough funds");
      // è½¬ç§»é’±
      _balances[sender] -= amount;
      _balances[recipient] += amount;
      // è§¦å‘è½¬ç§»äº‹ä»¶
      emit Transfer(sender, recipient, amount);
  }
}
```

###### å¯è¿­ä»£æ˜ å°„

æ˜ å°„æœ¬èº«æ˜¯æ— æ³•éå†çš„ï¼Œå³æ— æ³•æšä¸¾æ‰€æœ‰çš„é”®ã€‚ä¸è¿‡ï¼Œå¯ä»¥åœ¨å®ƒä»¬ä¹‹ä¸Šå®ç°ä¸€ä¸ªæ•°æ®ç»“æ„æ¥è¿›è¡Œè¿­ä»£ã€‚

```solidity
// ./IteratorMappingæ–‡ä»¶

//SPDX-License-Identifier: MIT

pragma solidity ^0.8.0;

struct IndexValue {
    uint256 keyIndex;
    uint256 value;
}

struct KeyFlag {
    uint256 key;
    bool deleted;
}

struct itmap {
    mapping (uint256 => IndexValue) data;
    KeyFlag[] keys;
    uint256 size;
}

type Iterator is uint256;

library IteratorMapping {

  function insert(itmap storage _self, uint256 _key, uint256 _value)
      internal
      returns (bool replaced)
  {
      uint256 keyIndex = _self.data[_key].keyIndex;
      _self.data[_key].value = _value;
      if(keyIndex > 0)
          return true;
      else {
          keyIndex = _self.keys.length;

          _self.keys.push();
          _self.data[_key].keyIndex = keyIndex + 1;
          _self.keys[keyIndex].key = _key;
          _self.size++;
          return false;
      }
  }

  function remove(itmap storage _self, uint256 _key) 
      internal
      returns (bool success)
  {
      uint256 keyIndex = _self.data[_key].keyIndex;
      if(keyIndex == 0)
          return false;
      delete _self.data[_key];
      _self.keys[keyIndex - 1].deleted = true;
      _self.size--;
      return true;
  }

  function contains(itmap storage _self, uint256 _key) 
      internal
      view
      returns (bool)
  {
      return _self.data[_key].keyIndex > 0;
  }

  function iteratorStart(itmap storage _self)
      internal
      view
      returns (Iterator)
  {
      return _iteratorSkipDeleted(_self, 0);
  }

  function iteratorValid(itmap storage _self, Iterator _iterator)
      internal
      view
      returns (bool)
  {
      return Iterator.unwrap(_iterator) < _self.keys.length;
  }

  function iteratorNext(itmap storage _self, Iterator _iterator)
      internal
      view
      returns (Iterator)
  {
      return _iteratorSkipDeleted(_self, Iterator.unwrap(_iterator) + 1);
  }

  function iteratorGet(itmap storage _self, Iterator _iterator)
      internal
      view
      returns (uint256 key, uint256 value)
  {
      uint256 keyIndex = Iterator.unwrap(_iterator);
      key = _self.keys[keyIndex].key;
      value = _self.data[key].value;
  }

  function _iteratorSkipDeleted(itmap storage _self, uint256 _keyIndex)
      private
      view
      returns (Iterator)
  {
      while (_keyIndex < _self.keys.length && _self.keys[_keyIndex].deleted)
          _keyIndex++;
      return Iterator.wrap(_keyIndex);
  }
}
// ./useræ–‡ä»¶

//SPDX-License-Identifier: MIT

pragma solidity ^0.8.0;

import "./IteratorMapping.sol";

contract User {
  itmap public data;

  using IteratorMapping for itmap;

  function insert(uint256 k, uint256 v) public returns (uint256 size) {
      data.insert(k, v);
      return data.size;
  }

  function sum() public view returns (uint256 s) {
      for(
          Iterator i = data.iteratorStart();
          data.iteratorValid(i);
          i = data.iteratorNext(i)
      ) {
          (,uint256 value) = data.iteratorGet(i);
          s += value;
      }
  }
}

```

#### 3ã€æ“ä½œç¬¦

å³ä½¿ä¸¤ä¸ªæ“ä½œæ•°çš„ç±»å‹ä¸ä¸€æ ·ï¼Œä¹Ÿå¯ä»¥è¿›è¡Œç®—æ•°å’Œä½æ“ä½œè¿ç®—ã€‚åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œå°†ä½¿ç”¨ä»¥ä¸‹æœºåˆ¶æ¥ç¡®å®šè¿ç®—ç»“æœçš„ç±»å‹ï¼ˆè¿™åœ¨æº¢å‡ºçš„æƒ…å†µä¸‹å¾ˆé‡è¦ï¼‰ï¼š

- å¦‚æœå³æ“ä½œæ•°çš„ç±»å‹å¯ä»¥éšå«çš„è½¬æ¢ä¸ºå·¦æ“ä½œæ•°çš„ç±»å‹çš„ç±»å‹ï¼Œåˆ™ä½¿ç”¨å·¦æ“ä½œæ•°çš„ç±»å‹ã€‚
- å¦‚æœå·¦æ“ä½œæ•°çš„ç±»å‹å¯ä»¥éšå«çš„è½¬æ¢ä¸ºå³æ“ä½œæ•°çš„ç±»å‹çš„ç±»å‹ï¼Œåˆ™ä½¿ç”¨å³æ“ä½œæ•°çš„ç±»å‹ã€‚
- å¦åˆ™ï¼Œè¯¥æ“ä½œä¸è¢«å…è®¸ã€‚
- è¿ç®—ç¬¦`**` `<<` `>>` ä½¿ç”¨å·¦æ“ä½œæ•°çš„ç±»å‹æ¥ä½œä¸ºç»“æœç±»å‹

##### 3-1ã€ä¸‰å…ƒè¿ç®—ç¬¦

`è¡¨è¾¾å¼ ? çœŸè¡¨è¾¾å¼ : å‡è¡¨è¾¾å¼`ã€‚ä¸‰å…ƒè¿ç®—ç¬¦çš„ç»“æœä¸ä¼šä¸ºæœ‰ç†æ•°ç±»å‹ã€‚ç»“æœç±»å‹æ˜¯ç”±ä¸¤ä¸ªæ“ä½œæ•°çš„ç±»å‹å†³å®šçš„ï¼Œå¦‚æœéœ€è¦çš„è¯ï¼Œé¦–å…ˆä¼šè½¬æ¢ä¸ºä»–ä»¬çš„æœ€å°å¯å®¹çº³ç±»å‹ã€‚

`255 + (true ? 1 : 0)`ï¼šå°†ç”±äºç®—æ•°æº¢å‡ºè€Œè¢«å›é€€ã€‚åŸå› æ˜¯`(true ? 1 : 0)`æ˜¯`uint8`ç±»å‹ï¼Œè¿™ä½¿å¾—åŠ æ³•ä¹Ÿè¦åœ¨`uint8`ä¸­æ‰§è¡Œã€‚256è¶…å‡ºäº†è¿™ä¸ªç±»å‹æ‰€å…è®¸çš„èŒƒå›´ã€‚

`1.5 + 1.5`ï¼šæ˜¯æœ‰æ•ˆçš„ï¼Œä»¥æ— é™ç²¾åº¦æ¥è¿›è¡Œæœ‰ç†è¡¨è¾¾å¼è¿ç®—ã€‚

`1.5 + (true ? 1.5 : 2.5)`ï¼šæ˜¯æ— æ•ˆçš„ï¼Œ`(true ? 1.5 : 2.5)`ä¼šè¿›è¡Œç±»å‹è½¬æ¢ï¼Œå°æ•°æœ‰ç†æ•°è½¬æ¢ä¸ºæ•´æ•°ï¼Œè¿™åœ¨ç›®å‰æ˜¯ä¸è¢«å…è®¸çš„ã€‚

##### 3-2ã€å¤åˆæ“ä½œåŠè‡ªå¢è‡ªå‡æ“ä½œ

å¤åˆæ“ä½œï¼š`+=` `-=` `*=` `/=` `%=` `!=` `&=` `^=` `<<=`ç­‰
`a++ a--`ï¼šè¡¨è¾¾å¼è¿”å›çš„å€¼ç­‰äº`a`åœ¨è®¡ç®—ä¹‹å‰çš„å€¼
`++a --a`ï¼šè¡¨è¾¾å¼è¿”å›çš„å€¼ç­‰äº`a`åœ¨è®¡ç®—ä¹‹åçš„å€¼

##### 3-3ã€delete

`delete a`çš„ç»“æœæ˜¯å°†`a`çš„åˆå§‹å€¼èµ‹å€¼ç»™`a`

- å¯¹äºæ•´å‹å˜é‡æ¥è¯´ï¼Œç›¸å½“äº `a = 0`
- å¯¹äºåŠ¨æ€æ•°ç»„æ¥è¯´ï¼Œç›¸å½“äºå°†å…¶é‡ç½®ä¸ºæ•°ç»„é•¿åº¦ä¸º0çš„æ•°ç»„
- å¯¹äºé™æ€æ•°ç»„æ¥è¯´ï¼Œç›¸å½“äºå°†æ•°ç»„ä¸­çš„æ‰€æœ‰å…ƒç´ é‡ç½®ä¸ºåˆå§‹å€¼
- `delete a[x]`ï¼Œç›¸å½“äºåˆ é™¤æ•°ç»„ç´¢å¼•`x`å¤„çš„å…ƒç´ ï¼Œå…¶ä»–çš„å…ƒç´ å’Œé•¿åº¦ä¸å˜ï¼Œè¿™æ„å‘³ç€æ•°ç»„ä¸­ç•™å‡ºäº†ä¸€ä¸ªç©ºä½
- å¯¹äºç»“æ„ä½“æ¥è¯´ï¼Œç›¸å½“äºå°†ç»“æ„ä½“ä¸­çš„æ‰€æœ‰å±æ€§é‡ç½®

`delete`å¯¹æ•´ä¸ªæ˜ å°„æ˜¯æ— æ•ˆçš„ï¼ˆå› ä¸ºæ˜ å°„çš„é”®æ˜¯ä»»æ„çš„ï¼Œé€šå¸¸ä¹Ÿæ˜¯æœªçŸ¥çš„ï¼‰ã€‚å› æ­¤åœ¨åˆ é™¤ä¸€ä¸ªç»“æ„ä½“æ—¶ï¼Œç»“æœå°†é‡ç½®æ‰€æœ‰çš„éæ˜ å°„å±æ€§ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯é€’å½’è¿›è¡Œçš„ï¼Œé™¤ééƒ½æ˜¯æ˜ å°„ã€‚ç„¶è€Œï¼Œå•ä¸ªçš„é”®åŠå…¶æ˜ å°„çš„å€¼æ˜¯å¯ä»¥è¢«åˆ é™¤çš„ã€‚

```solidity
//SPDX-License-Identifier: MIT

pragma solidity ^0.8.0;

contract DeleteLBC {
  uint256 data;
  uint256[] dataArray;

  function f() public {
      uint256 x = data;
      delete x; // å°† x è®¾ä¸º 9ï¼Œä¸å½±å“æ•°æ®
      delete data; // å°† data è®¾ä¸º 0ï¼Œä¸å½±å“x
      uint256[] storage y = dataArray; // ä¿å­˜å¼•ç”¨
      delete dataArray; // å°† dataArray.length è®¾ä¸º 0ï¼Œyä¹Ÿå°†å—åˆ°å½±å“
      // delete y; // è¿™æ˜¯éæ³•çš„ï¼Œå¼•ç”¨äº†storageå¯¹è±¡çš„å±€éƒ¨å˜é‡åªèƒ½ç”±å·²æœ‰çš„storageå¯¹è±¡èµ‹å€¼
  }
}
```

##### 3-3ã€è¿ç®—ç¬¦ä¼˜å…ˆçº§

<table>
  <colgroup>
    <col width="15%" />
    <col width="35%" />
    <col width="50%" />
  </colgroup>
	<tr>
	    <th>ä¼˜å…ˆçº§</th>
	    <th>æè¿°</th>
	    <th>è¿ç®—ç¬¦</th>  
	</tr >
	<tr >
	    <td rowspan="6">1</td>
	    <td>åç¼€è‡ªå¢è‡ªå‡</td>
	    <td>
        <code>a++ a--</code>
      </td>
	</tr>
	<tr>
	    <td>new</td>
	    <td>
        <code>new typename</code>
      </td>
	</tr>
	<tr>
	    <td>æ•°ç»„</td>
	    <td>
        <code>array[index]</code>
      </td>
	</tr>
	<tr>
	    <td>ç»“æ„ä½“</td>
	    <td>
        <code>object.member</code>
      </td>
	</tr>
	<tr>
    <td>å‡½æ•°</td>
	  <td>
      <code>function(args...)</code>
    </td>
	</tr>
	<tr>
	    <td>æ‹¬å·</td>
	    <td>
        <code>(statement)</code>
      </td>
	</tr>
	<tr>
      <td rowspan="5">2</td>
	    <td>å‰ç¼€è‡ªå¢è‡ªå‡</td>
	    <td>
        <code>++a --a</code>
      </td>
	</tr>
	<tr>
	    <td>ä¸€å…ƒè´Ÿå·</td>
	    <td>
        <code>-</code>
      </td>
	</tr>
	<tr>
	    <td >ä¸€å…ƒè¿ç®—</td>
	    <td>
        <code>delete</code>
      </td>
	</tr>
	<tr>
	    <td>é€»è¾‘å–å</td>
	    <td>
        <code>!</code>
      </td>
	</tr>
	<tr>
	    <td >ä½å–å</td>
	    <td>
        <code>~</code>
      </td>
	</tr>
	<tr>
	    <td >3</td>
	    <td >å¹‚æ“ä½œ</td>
	    <td >
        <code>**</code>
      </td>
	</tr>
	<tr>
	    <td >4</td>
	    <td >ä¹˜ï¼Œé™¤ï¼Œå–ä½™</td>
	    <td >
        <code>* / %</code>
      </td>
	</tr>
	<tr>
	    <td >5</td>
	    <td >åŠ ï¼Œå‡</td>
	    <td >
        <code>+ -</code>
      </td>
	</tr>
  <tr>
	    <td >6</td>
	    <td >å·¦ç§»ã€å³ç§»</td>
	    <td >
        <code><< >></code>
      </td>
	</tr>
	<tr>
	    <td >7</td>
	    <td >ä½ä¸</td>
	    <td >
        <code>&</code>
      </td>
	</tr>
	<tr>
	    <td >8</td>
	    <td >ä½å¼‚æˆ–</td>
	    <td >
        <code>^</code>
      </td>
	</tr>
  <tr>
	    <td >9</td>
	    <td >ä½æˆ–</td>
	    <td >
        <code>|</code>
      </td>
	</tr>
	<tr>
	    <td >10</td>
	    <td >æ¯”è¾ƒæ“ä½œç¬¦</td>
	    <td >
        <code>> >= < <=</code>
      </td>
	</tr>
	<tr>
	    <td >11</td>
	    <td >æƒ³ç­‰æ“ä½œç¬¦</td>
	    <td >
        <code>== !=</code>
      </td>
	</tr>
  <tr>
	    <td >12</td>
	    <td >é€»è¾‘ä¸</td>
	    <td >
        <code>&&</code>
      </td>
	</tr>
	<tr>
	    <td >13</td>
	    <td >é€»è¾‘æˆ–</td>
	    <td >
        <code>||</code>
      </td>
	</tr>
	<tr>
	    <td rowspan="2">14</td>
	    <td >ä¸‰å…ƒè¿ç®—ç¬¦</td>
	    <td >
        <code>è¡¨è¾¾å¼?çœŸ:å‡</code>
      </td>
	</tr>
  <tr>
      <td >å¤åˆæ“ä½œ</td>
	    <td >
        <code>= += -= /= *= %= |= ^\ &= <<= >>=</code>
      </td>
	</tr>
  <tr>
	    <td >15</td>
	    <td >é€—å·</td>
	    <td >
        <code>,</code>
      </td>
	</tr>
</table>

#### 4ã€åŸºæœ¬ç±»å‹ä¹‹é—´çš„è½¬æ¢

##### 4-1ã€éšå¼è½¬æ¢

åœ¨èµ‹å€¼ï¼Œå‚æ•°ä¼ é€’ç»™å‡½æ•°ä»¥åŠåº”ç”¨è¿ç®—ç¬¦æ—¶ï¼Œä¼šè¿›è¡Œéšå¼ç±»å‹è½¬æ¢

##### 4-2ã€æ˜¾å¼è½¬æ¢

å¦‚æœæŸäº›æƒ…å†µä¸‹ä¸æ”¯æŒéšå¼è½¬æ¢ï¼Œå¯ä»¥è€ƒè™‘æ˜¾å¼è½¬æ¢ã€‚

æ•´æ•°ç±»å‹æ˜¾å¼è½¬æ¢ä¸ºæ›´å°çš„ç±»å‹ï¼Œç›¸åº”çš„é«˜ä½å°†è¢«èˆå¼ƒã€‚å¦‚æœè½¬æ¢ä¸ºæ›´å¤§çš„ç±»å‹ï¼Œåˆ™å¡«å……å·¦ä¾§ï¼Œè½¬æ¢ç»“æœè¿˜æ˜¯ç­‰äºåŸæ¥çš„æ•´æ•°ã€‚

```solidity
uint32 a = 0x12345678;
uint16 b = uint16(a); // 0x5678

uint16 c = 0x1234;
uint32 d = uint32(c); // 0x00001234
```

å®šé•¿å­—èŠ‚æ•°ç»„è½¬æ¢ä¸ºæ›´å°çš„å­—èŠ‚æ—¶ï¼Œä¼šå‘ç”Ÿæˆªæ–­ã€‚è½¬æ¢ä¸ºæ›´å¤§çš„å­—èŠ‚æ—¶æŒ‰æ­£ç¡®æ–¹å¼å¡«å……ã€‚ä»¥å›ºå®šç´¢å¼•è®¿é—®è½¬æ¢åçš„å­—èŠ‚å’Œä¹‹å‰çš„å€¼ç›¸ç­‰ã€‚

```solidity
bytes2 a = 0x1234;
bytes1 b = bytes1(a); // 0x12

bytes2 c = 0x1234;
bytes4 d = bytes4(c); // 0x12340000
```

æ•´æ•°å’Œå®šé•¿å­—èŠ‚æ•°ç»„ä¹‹é—´çš„è½¬æ¢

```solidity
bytes2 a = 0x1234;
uint32 b = uint32(byte4(a)); // 0x12340000
uint32 c = uint16(a); // 0x00001234
uint8 d = uint8(uint16(a)); // 0x34
uint8 e = uint8(bytes1(a)); // 0x12
```

`bytes`æ•°ç»„å’Œ`bytes``calldata`åˆ‡ç‰‡å¯ä»¥æ˜¾å¼è½¬æ¢ä¸ºå›ºå®šé•¿åº¦çš„`bytes`ç±»å‹ã€‚å¦‚æœ`bytes`æ•°ç»„å’Œ`bytes``calldata`åˆ‡ç‰‡æ¯”å›ºå®šé•¿åº¦çš„`bytes`ç±»å‹æ•°ç»„é•¿ï¼Œåˆ™åœ¨æœ«å°¾å‘ç”Ÿæˆªæ–­ï¼Œåä¹‹ï¼Œæœ«å°¾ä»¥é›¶è¡¥å……ã€‚

#### 5ã€å­—é¢å¸¸é‡ä¸åŸºæœ¬ç±»å‹çš„è½¬æ¢

##### 5-1ã€æ•´å‹ä¸å­—é¢å¸¸é‡è½¬æ¢

åè¿›åˆ¶å’Œåå…­è¿›åˆ¶å­—é¢å¸¸é‡å¯ä»¥éšå¼è½¬æ¢ä¸ºä»»ä½•è¶³ä»¥è¡¨ç¤ºå®ƒè€Œä¸ä¼šæˆªæ–­çš„æ•´æ•°ç±»å‹ã€‚

##### 5-2ã€å®šé•¿å­—èŠ‚æ•°ç»„å’Œå­—é¢å¸¸é‡çš„è½¬æ¢

åè¿›åˆ¶å­—é¢å¸¸é‡ä¸èƒ½éšå¼è½¬æ¢ä¸ºå®šé•¿å­—èŠ‚æ•°ç»„ã€‚åå…­è¿›åˆ¶å­—é¢å¸¸é‡å¯ä»¥ï¼Œä½†ä»…å½“åå…­è¿›åˆ¶æ•°å­—å¤§å°å®Œå…¨ç¬¦åˆå®šé•¿å­—èŠ‚æ•°ç»„é•¿åº¦ã€‚**é›¶å€¼å¯ä»¥è½¬æ¢ä¸ºä»»ä½•å®šé•¿å­—èŠ‚æ•°ç»„**ã€‚

```solidity
bytes2 a = 5432; // no
bytes2 b = 0x12; // no
bytes2 c = 0x123; // no
bytes2 d = 0x1234; // yes
bytes2 e = 0x0012; // yes
bytes2 f = 0; // yes
bytes2 g = 0x0; // yes
```

å­—ç¬¦ä¸²å­—é¢å¸¸é‡å’Œåå…­è¿›åˆ¶å­—ç¬¦ä¸²å­—é¢å¸¸é‡å¯ä»¥éšå¼è½¬æ¢ä¸ºå®šé•¿å­—èŠ‚æ•°ç»„ï¼Œä»…å½“ä»–ä»¬çš„å­—ç¬¦æ•°ä¸å­—èŠ‚ç±»å‹çš„å¤§å°ç›¸åŒ¹é…ã€‚

```solidity
bytes2 a = hex"1234"; // yes
bytes2 b = "xy"; // yes
bytes2 c = hex"12"; // no
bytes2 d = hex"123"; // no
bytes2 e = "y"; // no
bytes2 f = "xyz"; // no
```

##### 5-3ã€åœ°å€ç±»å‹

åªæœ‰`bytes20`å’Œ`uint160`å…è®¸æ˜¾ç¤ºè½¬æ¢ä¸º`address`ç±»å‹

ä»`bytes20`æˆ–å…¶ä»–æ•´å‹æ˜¾å¼è½¬æ¢ä¸º`address`ç±»å‹æ—¶ï¼Œéƒ½ä¼šä½œä¸º`address payable`ç±»å‹

ä¸€ä¸ª`address a`ç±»å‹å¯ä»¥é€šè¿‡`payable(a)`è½¬æ¢ä¸º`address payable`ç±»å‹